import{c as u,V as M,r as k,j as e,I as P,B as d,f as o,s as n,g as t}from"./index-DZgJ29pE.js";import{u as S}from"./useQuery-Cz2LeAXE.js";import{u as x}from"./useMutation-6KN3B1wo.js";import{L as q}from"./label-BeAyWXnA.js";import{C as N,a as g,b as w,d as _,c as b}from"./card-B25bVudG.js";import{B as i}from"./badge-DjURDUju.js";import{T as I,a as T,b as L,c,d as z,e as l}from"./table-BK2hRZHQ.js";import{C as D}from"./circle-check-tQfM6UXB.js";import{C as F}from"./circle-x-B6_IdfzA.js";import{R as E}from"./refresh-cw-htFBMiaX.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=u("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=u("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=u("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=u("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);function ee(){const m=M(),[p,C]=k.useState(""),{data:a,isLoading:B}=S({queryKey:["mailerlite-config"],queryFn:async()=>{const{data:s,error:r}=await n.from("integrations_mailerlite").select("*").eq("is_active",!0).maybeSingle();if(r)throw r;return s}}),{data:h,isLoading:A}=S({queryKey:["mailerlite-sync-logs"],queryFn:async()=>{const{data:s,error:r}=await n.from("orders_sync_log").select("*").order("created_at",{ascending:!1}).limit(20);if(r)throw r;return s||[]}});k.useEffect(()=>{a!=null&&a.mailerlite_account_id&&C(a.mailerlite_account_id)},[a]);const j=x({mutationFn:async s=>{if(a!=null&&a.id){const{error:r}=await n.from("integrations_mailerlite").update({mailerlite_account_id:s}).eq("id",a.id);if(r)throw r}else{const{error:r}=await n.from("integrations_mailerlite").insert({mailerlite_account_id:s,shop_name:"Nave Studio CLP 2026",currency:"CLP"});if(r)throw r}},onSuccess:()=>{m.invalidateQueries({queryKey:["mailerlite-config"]}),t.success("Account ID guardado correctamente")},onError:s=>t.error("Error: "+s.message)}),y=x({mutationFn:async()=>{const{data:s,error:r}=await n.functions.invoke("mailerlite-init-shop",{body:{action:"health_check"}});if(r)throw r;return s},onSuccess:s=>{s.ok?t.success(s.message):t.error(s.message)},onError:s=>t.error("Error: "+s.message)}),f=x({mutationFn:async()=>{const{data:s,error:r}=await n.functions.invoke("mailerlite-init-shop",{body:{action:"init_shop"}});if(r)throw r;return s},onSuccess:s=>{m.invalidateQueries({queryKey:["mailerlite-config"]}),t.success(`Shop creado: ${s.shop_id}`)},onError:s=>t.error("Error: "+s.message)}),v=x({mutationFn:async()=>{const{data:s,error:r}=await n.functions.invoke("mailerlite-sync-order",{body:{order_id:`test-${Date.now()}`,order_type:"manual_test",total:1e3,subtotal:1e3,customer_email:"test@studiolanave.com",customer_name:"Test Nave Studio",items:[{product_id:"test-product-001",name:"Orden de prueba MailerLite",quantity:1,price:1e3}]}});if(r)throw r;return s},onSuccess:s=>{m.invalidateQueries({queryKey:["mailerlite-sync-logs"]}),s.status==="success"?t.success("Orden de prueba enviada correctamente"):s.status==="already_synced"?t.info("Orden ya sincronizada previamente"):t.error("Error al enviar orden: "+(s.error||"desconocido"))},onError:s=>t.error("Error: "+s.message)});return e.jsxs("div",{className:"space-y-6 p-4 md:p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"MailerLite E-commerce"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Configuración de shop e-commerce y atribución de campañas"})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(N,{children:[e.jsxs(g,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Configuración"]}),e.jsx(_,{children:"Account ID y estado del shop"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(q,{htmlFor:"account-id",children:"MailerLite Account ID"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsx(P,{id:"account-id",value:p,onChange:s=>C(s.target.value),placeholder:"Ej: 1234567",className:"flex-1"}),e.jsx(d,{onClick:()=>j.mutate(p),disabled:j.isPending||!p,size:"sm",children:j.isPending?e.jsx(o,{className:"h-4 w-4 animate-spin"}):"Guardar"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se usa para el Universal JS (tracking de atribución)"})]}),e.jsxs("div",{className:"pt-2 border-t space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Shop ID"}),a!=null&&a.mailerlite_shop_id?e.jsx(i,{variant:"outline",className:"font-mono text-xs",children:a.mailerlite_shop_id}):e.jsx(i,{variant:"secondary",children:"No configurado"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Nombre"}),e.jsx("span",{className:"text-sm text-gray-600",children:(a==null?void 0:a.shop_name)||"—"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Moneda"}),e.jsx("span",{className:"text-sm text-gray-600",children:(a==null?void 0:a.currency)||"CLP"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Universal JS"}),a!=null&&a.mailerlite_account_id?e.jsxs(i,{className:"bg-green-100 text-green-800",children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Activo"]}):e.jsxs(i,{variant:"destructive",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Sin Account ID"]})]})]})]})]}),e.jsxs(N,{children:[e.jsxs(g,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Acciones"]}),e.jsx(_,{children:"Health check, crear shop, orden de prueba"})]}),e.jsxs(b,{className:"space-y-3",children:[e.jsxs(d,{onClick:()=>y.mutate(),disabled:y.isPending,variant:"outline",className:"w-full justify-start",children:[y.isPending?e.jsx(o,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(E,{className:"h-4 w-4 mr-2"}),"Health Check API"]}),e.jsxs(d,{onClick:()=>f.mutate(),disabled:f.isPending,variant:"outline",className:"w-full justify-start",children:[f.isPending?e.jsx(o,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Q,{className:"h-4 w-4 mr-2"}),a!=null&&a.mailerlite_shop_id?"Verificar Shop":"Crear Shop Nuevo"]}),e.jsxs(d,{onClick:()=>v.mutate(),disabled:v.isPending||!(a!=null&&a.mailerlite_shop_id),variant:"outline",className:"w-full justify-start",children:[v.isPending?e.jsx(o,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(K,{className:"h-4 w-4 mr-2"}),"Enviar Orden de Prueba"]}),!(a!=null&&a.mailerlite_shop_id)&&e.jsx("p",{className:"text-xs text-amber-600",children:"⚠️ Debes crear el shop antes de enviar órdenes de prueba"})]})]})]}),e.jsxs(N,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(w,{children:"Logs de Sincronización"}),e.jsx(_,{children:"Últimas 20 sincronizaciones"})]}),e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>m.invalidateQueries({queryKey:["mailerlite-sync-logs"]}),children:e.jsx(E,{className:"h-4 w-4"})})]}),e.jsx(b,{children:A?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(o,{className:"h-6 w-6 animate-spin text-gray-400"})}):h!=null&&h.length?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(I,{children:[e.jsx(T,{children:e.jsxs(L,{children:[e.jsx(c,{children:"Fecha"}),e.jsx(c,{children:"Order ID"}),e.jsx(c,{children:"Tipo"}),e.jsx(c,{children:"Estado"}),e.jsx(c,{children:"HTTP"}),e.jsx(c,{children:"Error"})]})}),e.jsx(z,{children:h.map(s=>e.jsxs(L,{children:[e.jsx(l,{className:"text-xs whitespace-nowrap",children:new Date(s.created_at).toLocaleString("es-CL")}),e.jsx(l,{className:"font-mono text-xs max-w-[120px] truncate",children:s.order_id}),e.jsx(l,{children:e.jsx(i,{variant:"outline",className:"text-xs",children:s.order_type})}),e.jsx(l,{children:s.status==="success"?e.jsx(i,{className:"bg-green-100 text-green-800 text-xs",children:"✓ OK"}):s.status==="pending"?e.jsx(i,{variant:"secondary",className:"text-xs",children:"Pendiente"}):e.jsx(i,{variant:"destructive",className:"text-xs",children:"Error"})}),e.jsx(l,{className:"text-xs",children:s.http_status||"—"}),e.jsx(l,{className:"text-xs max-w-[200px] truncate text-red-600",children:s.error_message||"—"})]},s.id))})]})}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-8",children:"No hay logs de sincronización aún"})})]})]})}export{ee as default};
