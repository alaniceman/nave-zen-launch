import{r as c,s as n,g as t,j as e,Z as S,aE as E,B as m,_ as D,$ as F,a0 as z,I as _}from"./index-1pEVpULT.js";import{C as L}from"./card-CF-BzD_C.js";import{L as l}from"./label-D2tu44sv.js";import{T}from"./textarea-bW-mYchQ.js";import{C as k,S as h}from"./switch-CBxzoL-4.js";import{P as A}from"./plus-CWeHqnni.js";import{P as I}from"./pencil-DcdVEiXj.js";import{T as M}from"./trash-2-DqOva4YU.js";import"./index-Bi7e8y7r.js";import"./check-adezDjKp.js";function K(){const[v,f]=c.useState([]),[g,y]=c.useState([]),[b,u]=c.useState(!1),[d,x]=c.useState(null),[a,r]=c.useState({name:"",description:"",sessions_quantity:1,price_clp:0,validity_days:90,applicable_service_ids:[],is_active:!0,available_as_giftcard:!1,show_in_upsell_modal:!1,show_in_criomedicina:!1}),o=c.useCallback(async()=>{const{data:s,error:i}=await n.from("session_packages").select("*").order("sessions_quantity");if(i){t.error("Error al cargar paquetes");return}f(s||[])},[]),p=c.useCallback(async()=>{const{data:s,error:i}=await n.from("services").select("id, name").eq("is_active",!0);if(i){t.error("Error al cargar servicios");return}y(s||[])},[]);c.useEffect(()=>{o(),p()},[o,p]);const C=async s=>{if(s.preventDefault(),d){const{error:i}=await n.from("session_packages").update(a).eq("id",d.id);if(i){t.error("Error al actualizar paquete");return}t.success("Paquete actualizado")}else{const{error:i}=await n.from("session_packages").insert([a]);if(i){t.error("Error al crear paquete");return}t.success("Paquete creado")}u(!1),j(),o()},w=async s=>{if(!confirm("¿Estás seguro de eliminar este paquete?"))return;const{error:i}=await n.from("session_packages").delete().eq("id",s);if(i){t.error("Error al eliminar paquete");return}t.success("Paquete eliminado"),o()},N=s=>{x(s),r({name:s.name,description:s.description,sessions_quantity:s.sessions_quantity,price_clp:s.price_clp,validity_days:s.validity_days,applicable_service_ids:s.applicable_service_ids,is_active:s.is_active,available_as_giftcard:s.available_as_giftcard??!1,show_in_upsell_modal:s.show_in_upsell_modal??!1,show_in_criomedicina:s.show_in_criomedicina??!1}),u(!0)},j=()=>{x(null),r({name:"",description:"",sessions_quantity:1,price_clp:0,validity_days:90,applicable_service_ids:[],is_active:!0,available_as_giftcard:!1,show_in_upsell_modal:!1,show_in_criomedicina:!1})},q=s=>{r(i=>({...i,applicable_service_ids:i.applicable_service_ids.includes(s)?i.applicable_service_ids.filter(P=>P!==s):[...i.applicable_service_ids,s]}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Paquetes de Sesiones"}),e.jsxs(S,{open:b,onOpenChange:s=>{u(s),s||j()},children:[e.jsx(E,{asChild:!0,children:e.jsxs(m,{children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Nuevo Paquete"]})}),e.jsxs(D,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(F,{children:e.jsx(z,{children:d?"Editar Paquete":"Nuevo Paquete"})}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",children:"Nombre *"}),e.jsx(_,{id:"name",value:a.name,onChange:s=>r({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"description",children:"Descripción"}),e.jsx(T,{id:"description",value:a.description,onChange:s=>r({...a,description:s.target.value}),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"sessions_quantity",children:"Cantidad de Sesiones *"}),e.jsx(_,{id:"sessions_quantity",type:"number",min:"1",value:a.sessions_quantity,onChange:s=>r({...a,sessions_quantity:parseInt(s.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"price_clp",children:"Precio (CLP) *"}),e.jsx(_,{id:"price_clp",type:"number",min:"0",value:a.price_clp,onChange:s=>r({...a,price_clp:parseInt(s.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"validity_days",children:"Validez (días) *"}),e.jsx(_,{id:"validity_days",type:"number",min:"1",value:a.validity_days,onChange:s=>r({...a,validity_days:parseInt(s.target.value)}),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"mb-3 block",children:"Servicios Aplicables *"}),e.jsx("div",{className:"space-y-2 border rounded-lg p-4",children:g.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{id:s.id,checked:a.applicable_service_ids.includes(s.id),onCheckedChange:()=>q(s.id)}),e.jsx("label",{htmlFor:s.id,className:"text-sm cursor-pointer",children:s.name})]},s.id))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{id:"is_active",checked:a.is_active,onCheckedChange:s=>r({...a,is_active:s})}),e.jsx(l,{htmlFor:"is_active",children:"Activo"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{id:"available_as_giftcard",checked:a.available_as_giftcard,onCheckedChange:s=>r({...a,available_as_giftcard:s})}),e.jsx(l,{htmlFor:"available_as_giftcard",children:"Disponible como Gift Card"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{id:"show_in_upsell_modal",checked:a.show_in_upsell_modal,onCheckedChange:s=>r({...a,show_in_upsell_modal:s})}),e.jsx(l,{htmlFor:"show_in_upsell_modal",children:"Mostrar en modal de upsell (agenda)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{id:"show_in_criomedicina",checked:a.show_in_criomedicina,onCheckedChange:s=>r({...a,show_in_criomedicina:s})}),e.jsx(l,{htmlFor:"show_in_criomedicina",children:"Mostrar en página Criomedicina"})]}),e.jsxs(m,{type:"submit",className:"w-full",children:[d?"Actualizar":"Crear"," Paquete"]})]})]})]})]}),e.jsx("div",{className:"grid gap-4",children:v.map(s=>e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"mt-3 space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Sesiones:"})," ",s.sessions_quantity]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Precio:"})," $",s.price_clp.toLocaleString("es-CL")," CLP"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Validez:"})," ",s.validity_days," días"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Estado:"})," ",s.is_active?"Activo":"Inactivo"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gift Card:"})," ",s.available_as_giftcard?"✅ Sí":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Modal Upsell:"})," ",s.show_in_upsell_modal?"✅ Sí":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Página Criomedicina:"})," ",s.show_in_criomedicina?"✅ Sí":"No"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{size:"sm",variant:"outline",onClick:()=>N(s),children:e.jsx(I,{className:"h-4 w-4"})}),e.jsx(m,{size:"sm",variant:"destructive",onClick:()=>w(s.id),children:e.jsx(M,{className:"h-4 w-4"})})]})]})},s.id))})]})}export{K as default};
