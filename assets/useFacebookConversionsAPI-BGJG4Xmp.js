import{r as t,s as C}from"./index-Dk2_iIft.js";const P=()=>{const n=document.cookie.match(/_fbp=([^;]+)/);return n?n[1]:void 0},_=()=>{const n=document.cookie.match(/_fbc=([^;]+)/);if(n)return n[1];const o=new URLSearchParams(window.location.search).get("fbclid");if(o)return`fb.1.${Date.now()}.${o}`},y=()=>`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,E=()=>{const n=t.useCallback(async({eventName:e,eventId:l,userEmail:d,userPhone:v,userName:m,value:b,currency:k,contentName:h,contentType:N,contentIds:f,orderId:I})=>{const s=l||y();try{const{data:r,error:a}=await C.functions.invoke("facebook-conversions",{body:{event_name:e,event_id:s,event_source_url:window.location.href,user_email:d,user_phone:v,user_name:m,value:b,currency:k||"CLP",content_name:h,content_type:N,content_ids:f,order_id:I,fbc:_(),fbp:P()}});a?console.error("Facebook Conversions API error:",a):console.log("Facebook Conversions API success:",r)}catch(r){console.error("Failed to send server event:",r)}return s},[]),c=t.useCallback(async e=>n({eventName:"Purchase",eventId:e.eventId,userEmail:e.userEmail,userName:e.userName,userPhone:e.userPhone,value:e.value,currency:e.currency,contentName:e.contentName,contentType:"product",contentIds:[e.orderId],orderId:e.orderId}),[n]),o=t.useCallback(async e=>n({eventName:"InitiateCheckout",userEmail:e.userEmail,userName:e.userName,value:e.value,contentName:e.contentName}),[n]),u=t.useCallback(async e=>n({eventName:"Lead",userEmail:e.userEmail,userName:e.userName,userPhone:e.userPhone,contentName:e.contentName}),[n]),i=t.useCallback(async e=>n({eventName:"ViewContent",contentName:e.contentName,value:e.value}),[n]);return{trackServerEvent:n,trackPurchase:c,trackInitiateCheckout:o,trackLead:u,trackViewContent:i}};export{E as u};
