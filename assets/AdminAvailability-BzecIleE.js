import{c as cr,x as lr,m as W,r as d,j as e,v as Y,n as ce,ad as dr,p as E,q as _,o as he,t as ge,aB as ur,a as K,V as je,Y as mr,Z as fr,_ as pr,$ as xr,I as G,B as L,f as be,s as P,g as M}from"./index-DgMpF62C.js";import{u as se}from"./useQuery-BTxbnbv1.js";import{u as ae}from"./useMutation-CWL1BRlX.js";import{C as pe,c as xe}from"./card-C8hB7ibz.js";import{T as vr,a as hr,b as ee,c as D,d as gr,e as S}from"./table-BxbxVbda.js";import{u as jr}from"./index.esm-CwA3zrSh.js";import{o as br,s as O,e as yr,n as V,b as _r,t as Rr}from"./zod-yqzwEcrb.js";import{F as Cr,a as R,b as C,c as w,d as T,e as I}from"./form-AJ9sHeNs.js";import{C as wr,S as Tr}from"./switch-763QSF6w.js";import{S as q,a as H,b as $,c as U,d as A}from"./select-8dj-i9Ck.js";import{u as le}from"./index-B-Iwk0i_.js";import{u as Ir}from"./index-DJwoYwHJ.js";import{L as ve}from"./label-CE2J_Qba.js";import{A as Er,b as Fr,c as Nr,d as Sr,e as Ar,f as kr,g as Dr,h as Pr}from"./alert-dialog-B10pn27x.js";import{P as Mr}from"./plus-C3tBHcL7.js";import{P as Gr}from"./pencil-FWxgCYvq.js";import{T as Or}from"./trash-2-DAp8J_5G.js";import"./check-ChRAgIYV.js";import"./chevron-down-DGyKDyC-.js";import"./chevron-up-BWEP_Trh.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=cr("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var re="rovingFocusGroup.onEntryFocus",Kr={bubbles:!1,cancelable:!0},B="RovingFocusGroup",[ne,ye,Br]=lr(B),[Vr,z]=W(B,[Br]),[qr,Hr]=Vr(B),_e=d.forwardRef((s,o)=>e.jsx(ne.Provider,{scope:s.__scopeRovingFocusGroup,children:e.jsx(ne.Slot,{scope:s.__scopeRovingFocusGroup,children:e.jsx($r,{...s,ref:o})})}));_e.displayName=B;var $r=d.forwardRef((s,o)=>{const{__scopeRovingFocusGroup:a,orientation:t,loop:c=!1,dir:m,currentTabStopId:l,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:v,onEntryFocus:h,preventScrollOnEntryFocus:r=!1,...n}=s,f=d.useRef(null),x=Y(o,f),g=le(m),[j,u]=ce({prop:l,defaultProp:i??null,onChange:v,caller:B}),[p,F]=d.useState(!1),b=dr(h),N=ye(a),X=d.useRef(!1),[ar,me]=d.useState(0);return d.useEffect(()=>{const y=f.current;if(y)return y.addEventListener(re,b),()=>y.removeEventListener(re,b)},[b]),e.jsx(qr,{scope:a,orientation:t,dir:g,loop:c,currentTabStopId:j,onItemFocus:d.useCallback(y=>u(y),[u]),onItemShiftTab:d.useCallback(()=>F(!0),[]),onFocusableItemAdd:d.useCallback(()=>me(y=>y+1),[]),onFocusableItemRemove:d.useCallback(()=>me(y=>y-1),[]),children:e.jsx(E.div,{tabIndex:p||ar===0?-1:0,"data-orientation":t,...n,ref:x,style:{outline:"none",...s.style},onMouseDown:_(s.onMouseDown,()=>{X.current=!0}),onFocus:_(s.onFocus,y=>{const nr=!X.current;if(y.target===y.currentTarget&&nr&&!p){const fe=new CustomEvent(re,Kr);if(y.currentTarget.dispatchEvent(fe),!fe.defaultPrevented){const Z=N().filter(k=>k.focusable),or=Z.find(k=>k.active),tr=Z.find(k=>k.id===j),ir=[or,tr,...Z].filter(Boolean).map(k=>k.ref.current);we(ir,r)}}X.current=!1}),onBlur:_(s.onBlur,()=>F(!1))})})}),Re="RovingFocusGroupItem",Ce=d.forwardRef((s,o)=>{const{__scopeRovingFocusGroup:a,focusable:t=!0,active:c=!1,tabStopId:m,children:l,...i}=s,v=he(),h=m||v,r=Hr(Re,a),n=r.currentTabStopId===h,f=ye(a),{onFocusableItemAdd:x,onFocusableItemRemove:g,currentTabStopId:j}=r;return d.useEffect(()=>{if(t)return x(),()=>g()},[t,x,g]),e.jsx(ne.ItemSlot,{scope:a,id:h,focusable:t,active:c,children:e.jsx(E.span,{tabIndex:n?0:-1,"data-orientation":r.orientation,...i,ref:o,onMouseDown:_(s.onMouseDown,u=>{t?r.onItemFocus(h):u.preventDefault()}),onFocus:_(s.onFocus,()=>r.onItemFocus(h)),onKeyDown:_(s.onKeyDown,u=>{if(u.key==="Tab"&&u.shiftKey){r.onItemShiftTab();return}if(u.target!==u.currentTarget)return;const p=Yr(u,r.orientation,r.dir);if(p!==void 0){if(u.metaKey||u.ctrlKey||u.altKey||u.shiftKey)return;u.preventDefault();let b=f().filter(N=>N.focusable).map(N=>N.ref.current);if(p==="last")b.reverse();else if(p==="prev"||p==="next"){p==="prev"&&b.reverse();const N=b.indexOf(u.currentTarget);b=r.loop?zr(b,N+1):b.slice(N+1)}setTimeout(()=>we(b))}}),children:typeof l=="function"?l({isCurrentTabStop:n,hasTabStop:j!=null}):l})})});Ce.displayName=Re;var Ur={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Wr(s,o){return o!=="rtl"?s:s==="ArrowLeft"?"ArrowRight":s==="ArrowRight"?"ArrowLeft":s}function Yr(s,o,a){const t=Wr(s.key,a);if(!(o==="vertical"&&["ArrowLeft","ArrowRight"].includes(t))&&!(o==="horizontal"&&["ArrowUp","ArrowDown"].includes(t)))return Ur[t]}function we(s,o=!1){const a=document.activeElement;for(const t of s)if(t===a||(t.focus({preventScroll:o}),document.activeElement!==a))return}function zr(s,o){return s.map((a,t)=>s[(o+t)%s.length])}var Te=_e,Ie=Ce,de="Radio",[Qr,Ee]=W(de),[Jr,Xr]=Qr(de),Fe=d.forwardRef((s,o)=>{const{__scopeRadio:a,name:t,checked:c=!1,required:m,disabled:l,value:i="on",onCheck:v,form:h,...r}=s,[n,f]=d.useState(null),x=Y(o,u=>f(u)),g=d.useRef(!1),j=n?h||!!n.closest("form"):!0;return e.jsxs(Jr,{scope:a,checked:c,disabled:l,children:[e.jsx(E.button,{type:"button",role:"radio","aria-checked":c,"data-state":ke(c),"data-disabled":l?"":void 0,disabled:l,value:i,...r,ref:x,onClick:_(s.onClick,u=>{c||v==null||v(),j&&(g.current=u.isPropagationStopped(),g.current||u.stopPropagation())})}),j&&e.jsx(Ae,{control:n,bubbles:!g.current,name:t,value:i,checked:c,required:m,disabled:l,form:h,style:{transform:"translateX(-100%)"}})]})});Fe.displayName=de;var Ne="RadioIndicator",Se=d.forwardRef((s,o)=>{const{__scopeRadio:a,forceMount:t,...c}=s,m=Xr(Ne,a);return e.jsx(ge,{present:t||m.checked,children:e.jsx(E.span,{"data-state":ke(m.checked),"data-disabled":m.disabled?"":void 0,...c,ref:o})})});Se.displayName=Ne;var Zr="RadioBubbleInput",Ae=d.forwardRef(({__scopeRadio:s,control:o,checked:a,bubbles:t=!0,...c},m)=>{const l=d.useRef(null),i=Y(l,m),v=Ir(a),h=ur(o);return d.useEffect(()=>{const r=l.current;if(!r)return;const n=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(n,"checked").set;if(v!==a&&x){const g=new Event("click",{bubbles:t});x.call(r,a),r.dispatchEvent(g)}},[v,a,t]),e.jsx(E.input,{type:"radio","aria-hidden":!0,defaultChecked:a,...c,tabIndex:-1,ref:i,style:{...c.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ae.displayName=Zr;function ke(s){return s?"checked":"unchecked"}var es=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Q="RadioGroup",[rs,Ps]=W(Q,[z,Ee]),De=z(),Pe=Ee(),[ss,as]=rs(Q),Me=d.forwardRef((s,o)=>{const{__scopeRadioGroup:a,name:t,defaultValue:c,value:m,required:l=!1,disabled:i=!1,orientation:v,dir:h,loop:r=!0,onValueChange:n,...f}=s,x=De(a),g=le(h),[j,u]=ce({prop:m,defaultProp:c??null,onChange:n,caller:Q});return e.jsx(ss,{scope:a,name:t,required:l,disabled:i,value:j,onValueChange:u,children:e.jsx(Te,{asChild:!0,...x,orientation:v,dir:g,loop:r,children:e.jsx(E.div,{role:"radiogroup","aria-required":l,"aria-orientation":v,"data-disabled":i?"":void 0,dir:g,...f,ref:o})})})});Me.displayName=Q;var Ge="RadioGroupItem",Oe=d.forwardRef((s,o)=>{const{__scopeRadioGroup:a,disabled:t,...c}=s,m=as(Ge,a),l=m.disabled||t,i=De(a),v=Pe(a),h=d.useRef(null),r=Y(o,h),n=m.value===c.value,f=d.useRef(!1);return d.useEffect(()=>{const x=j=>{es.includes(j.key)&&(f.current=!0)},g=()=>f.current=!1;return document.addEventListener("keydown",x),document.addEventListener("keyup",g),()=>{document.removeEventListener("keydown",x),document.removeEventListener("keyup",g)}},[]),e.jsx(Ie,{asChild:!0,...i,focusable:!l,active:n,children:e.jsx(Fe,{disabled:l,required:m.required,checked:n,...v,...c,name:m.name,ref:r,onCheck:()=>m.onValueChange(c.value),onKeyDown:_(x=>{x.key==="Enter"&&x.preventDefault()}),onFocus:_(c.onFocus,()=>{var x;f.current&&((x=h.current)==null||x.click())})})})});Oe.displayName=Ge;var ns="RadioGroupIndicator",Le=d.forwardRef((s,o)=>{const{__scopeRadioGroup:a,...t}=s,c=Pe(a);return e.jsx(Se,{...c,...t,ref:o})});Le.displayName=ns;var Ke=Me,Be=Oe,os=Le;const Ve=d.forwardRef(({className:s,...o},a)=>e.jsx(Ke,{className:K("grid gap-2",s),...o,ref:a}));Ve.displayName=Ke.displayName;const oe=d.forwardRef(({className:s,...o},a)=>e.jsx(Be,{ref:a,className:K("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...o,children:e.jsx(os,{className:"flex items-center justify-center",children:e.jsx(Lr,{className:"h-2.5 w-2.5 fill-current text-current"})})}));oe.displayName=Be.displayName;const ts=br({professionalId:O().min(1,"Selecciona un profesional"),serviceId:O().optional(),recurrenceType:yr(["weekly","specific_date"]),dayOfWeek:V().min(0).max(6).optional(),specificDate:O().optional(),startTime:O().regex(/^\d{2}:\d{2}$/,"Formato HH:MM"),endTime:O().regex(/^\d{2}:\d{2}$/,"Formato HH:MM"),durationMinutes:V().min(15).max(480),maxDaysInFuture:V().min(1).max(365),minHoursBeforeBooking:V().min(0).max(168),isActive:_r().default(!0)}).refine(s=>!(s.recurrenceType==="weekly"&&s.dayOfWeek===void 0||s.recurrenceType==="specific_date"&&!s.specificDate),{message:"Debes especificar el día de la semana o la fecha específica"}),is=[{value:0,label:"Domingo"},{value:1,label:"Lunes"},{value:2,label:"Martes"},{value:3,label:"Miércoles"},{value:4,label:"Jueves"},{value:5,label:"Viernes"},{value:6,label:"Sábado"}];function cs({open:s,onClose:o,rule:a}){const t=je(),c=!!a,{data:m}=se({queryKey:["professionals-active"],queryFn:async()=>{const{data:r,error:n}=await P.from("professionals").select("*").eq("is_active",!0);if(n)throw n;return r}}),{data:l}=se({queryKey:["services-active"],queryFn:async()=>{const{data:r,error:n}=await P.from("services").select("*").eq("is_active",!0);if(n)throw n;return r}}),i=jr({resolver:Rr(ts),defaultValues:{professionalId:"",serviceId:void 0,recurrenceType:"weekly",startTime:"09:00",endTime:"18:00",durationMinutes:60,maxDaysInFuture:30,minHoursBeforeBooking:3,isActive:!0}});d.useEffect(()=>{if(a){const r=a.recurrence_type==="WEEKLY"?"weekly":"specific_date";i.reset({professionalId:a.professional_id,serviceId:a.service_id||void 0,recurrenceType:r,dayOfWeek:a.day_of_week,specificDate:a.specific_date,startTime:a.start_time,endTime:a.end_time,durationMinutes:a.duration_minutes,maxDaysInFuture:a.max_days_in_future,minHoursBeforeBooking:a.min_hours_before_booking,isActive:a.is_active})}},[a,i]);const v=ae({mutationFn:async r=>{const n=r.recurrenceType==="weekly"?"WEEKLY":"ONCE",f={professional_id:r.professionalId,service_id:r.serviceId||null,recurrence_type:n,day_of_week:r.recurrenceType==="weekly"?r.dayOfWeek:null,specific_date:r.recurrenceType==="specific_date"?r.specificDate:null,start_time:r.startTime,end_time:r.endTime,duration_minutes:r.durationMinutes,max_days_in_future:r.maxDaysInFuture,min_hours_before_booking:r.minHoursBeforeBooking,is_active:r.isActive};if(c){const{error:x}=await P.from("availability_rules").update(f).eq("id",a.id);if(x)throw x}else{const{error:x}=await P.from("availability_rules").insert(f);if(x)throw x}},onSuccess:()=>{t.invalidateQueries({queryKey:["availability-rules-admin"]}),M.success(c?"Regla actualizada":"Regla creada"),o()},onError:r=>{M.error(r.message||"Error al guardar regla")}}),h=r=>{v.mutate(r)};return e.jsx(mr,{open:s,onOpenChange:o,children:e.jsxs(fr,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(pr,{children:e.jsx(xr,{children:c?"Editar Regla de Disponibilidad":"Nueva Regla de Disponibilidad"})}),e.jsx(Cr,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(h),className:"space-y-4",children:[e.jsx(R,{control:i.control,name:"professionalId",render:({field:r})=>e.jsxs(C,{children:[e.jsx(w,{children:"Profesional"}),e.jsxs(q,{onValueChange:r.onChange,value:r.value,children:[e.jsx(T,{children:e.jsx(H,{children:e.jsx($,{placeholder:"Selecciona un profesional"})})}),e.jsx(U,{children:m==null?void 0:m.map(n=>e.jsx(A,{value:n.id,children:n.name},n.id))})]}),e.jsx(I,{})]})}),e.jsx(R,{control:i.control,name:"serviceId",render:({field:r})=>e.jsxs(C,{children:[e.jsx(w,{children:"Servicio (opcional)"}),e.jsxs(q,{onValueChange:n=>r.onChange(n==="all"?void 0:n),value:r.value||"all",children:[e.jsx(T,{children:e.jsx(H,{children:e.jsx($,{placeholder:"Todos los servicios"})})}),e.jsxs(U,{children:[e.jsx(A,{value:"all",children:"Todos los servicios"}),l==null?void 0:l.map(n=>e.jsx(A,{value:n.id,children:n.name},n.id))]})]}),e.jsx(I,{})]})}),e.jsx(R,{control:i.control,name:"recurrenceType",render:({field:r})=>e.jsxs(C,{children:[e.jsx(w,{children:"Tipo de Recurrencia"}),e.jsx(T,{children:e.jsxs(Ve,{onValueChange:r.onChange,value:r.value,className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{value:"weekly",id:"weekly"}),e.jsx(ve,{htmlFor:"weekly",children:"Semanal"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(oe,{value:"specific_date",id:"specific_date"}),e.jsx(ve,{htmlFor:"specific_date",children:"Fecha Específica"})]})]})}),e.jsx(I,{})]})}),i.watch("recurrenceType")==="weekly"&&e.jsx(R,{control:i.control,name:"dayOfWeek",render:({field:r})=>{var n;return e.jsxs(C,{children:[e.jsx(w,{children:"Día de la Semana"}),e.jsxs(q,{onValueChange:f=>r.onChange(parseInt(f)),value:(n=r.value)==null?void 0:n.toString(),children:[e.jsx(T,{children:e.jsx(H,{children:e.jsx($,{placeholder:"Selecciona un día"})})}),e.jsx(U,{children:is.map(f=>e.jsx(A,{value:f.value.toString(),children:f.label},f.value))})]}),e.jsx(I,{})]})}}),i.watch("recurrenceType")==="specific_date"&&e.jsx(R,{control:i.control,name:"specificDate",render:({field:r})=>e.jsxs(C,{children:[e.jsx(w,{children:"Fecha Específica"}),e.jsx(T,{children:e.jsx(G,{...r,type:"date"})}),e.jsx(I,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(R,{control:i.control,name:"startTime",render:({field:r})=>e.jsxs(C,{children:[e.jsx(w,{children:"Hora Inicio"}),e.jsx(T,{children:e.jsx(G,{...r,type:"time"})}),e.jsx(I,{})]})}),e.jsx(R,{control:i.control,name:"endTime",render:({field:r})=>e.jsxs(C,{children:[e.jsx(w,{children:"Hora Fin"}),e.jsx(T,{children:e.jsx(G,{...r,type:"time"})}),e.jsx(I,{})]})})]}),e.jsx(R,{control:i.control,name:"durationMinutes",render:({field:r})=>e.jsxs(C,{children:[e.jsx(w,{children:"Duración del Slot (minutos)"}),e.jsxs(q,{onValueChange:n=>r.onChange(parseInt(n)),value:r.value.toString(),children:[e.jsx(T,{children:e.jsx(H,{children:e.jsx($,{})})}),e.jsxs(U,{children:[e.jsx(A,{value:"30",children:"30 minutos"}),e.jsx(A,{value:"60",children:"60 minutos"}),e.jsx(A,{value:"90",children:"90 minutos"}),e.jsx(A,{value:"120",children:"120 minutos"})]})]}),e.jsx(I,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(R,{control:i.control,name:"maxDaysInFuture",render:({field:r})=>e.jsxs(C,{children:[e.jsx(w,{children:"Días Máximos en el Futuro"}),e.jsx(T,{children:e.jsx(G,{...r,type:"number",onChange:n=>r.onChange(parseInt(n.target.value))})}),e.jsx(I,{})]})}),e.jsx(R,{control:i.control,name:"minHoursBeforeBooking",render:({field:r})=>e.jsxs(C,{children:[e.jsx(w,{children:"Horas Mínimas de Anticipación"}),e.jsx(T,{children:e.jsx(G,{...r,type:"number",onChange:n=>r.onChange(parseInt(n.target.value))})}),e.jsx(I,{})]})})]}),e.jsx(R,{control:i.control,name:"isActive",render:({field:r})=>e.jsxs(C,{className:"flex items-center space-x-2",children:[e.jsx(T,{children:e.jsx(wr,{checked:r.value,onCheckedChange:r.onChange})}),e.jsx(w,{className:"!mt-0",children:"Activo"})]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(L,{type:"button",variant:"outline",onClick:o,children:"Cancelar"}),e.jsxs(L,{type:"submit",disabled:v.isPending,children:[v.isPending&&e.jsx(be,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Actualizar":"Crear"]})]})]})})]})})}var J="Tabs",[ls,Ms]=W(J,[z]),qe=z(),[ds,ue]=ls(J),He=d.forwardRef((s,o)=>{const{__scopeTabs:a,value:t,onValueChange:c,defaultValue:m,orientation:l="horizontal",dir:i,activationMode:v="automatic",...h}=s,r=le(i),[n,f]=ce({prop:t,onChange:c,defaultProp:m??"",caller:J});return e.jsx(ds,{scope:a,baseId:he(),value:n,onValueChange:f,orientation:l,dir:r,activationMode:v,children:e.jsx(E.div,{dir:r,"data-orientation":l,...h,ref:o})})});He.displayName=J;var $e="TabsList",Ue=d.forwardRef((s,o)=>{const{__scopeTabs:a,loop:t=!0,...c}=s,m=ue($e,a),l=qe(a);return e.jsx(Te,{asChild:!0,...l,orientation:m.orientation,dir:m.dir,loop:t,children:e.jsx(E.div,{role:"tablist","aria-orientation":m.orientation,...c,ref:o})})});Ue.displayName=$e;var We="TabsTrigger",Ye=d.forwardRef((s,o)=>{const{__scopeTabs:a,value:t,disabled:c=!1,...m}=s,l=ue(We,a),i=qe(a),v=Je(l.baseId,t),h=Xe(l.baseId,t),r=t===l.value;return e.jsx(Ie,{asChild:!0,...i,focusable:!c,active:r,children:e.jsx(E.button,{type:"button",role:"tab","aria-selected":r,"aria-controls":h,"data-state":r?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:v,...m,ref:o,onMouseDown:_(s.onMouseDown,n=>{!c&&n.button===0&&n.ctrlKey===!1?l.onValueChange(t):n.preventDefault()}),onKeyDown:_(s.onKeyDown,n=>{[" ","Enter"].includes(n.key)&&l.onValueChange(t)}),onFocus:_(s.onFocus,()=>{const n=l.activationMode!=="manual";!r&&!c&&n&&l.onValueChange(t)})})})});Ye.displayName=We;var ze="TabsContent",Qe=d.forwardRef((s,o)=>{const{__scopeTabs:a,value:t,forceMount:c,children:m,...l}=s,i=ue(ze,a),v=Je(i.baseId,t),h=Xe(i.baseId,t),r=t===i.value,n=d.useRef(r);return d.useEffect(()=>{const f=requestAnimationFrame(()=>n.current=!1);return()=>cancelAnimationFrame(f)},[]),e.jsx(ge,{present:c||r,children:({present:f})=>e.jsx(E.div,{"data-state":r?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":v,hidden:!f,id:h,tabIndex:0,...l,ref:o,style:{...s.style,animationDuration:n.current?"0s":void 0},children:f&&m})})});Qe.displayName=ze;function Je(s,o){return`${s}-trigger-${o}`}function Xe(s,o){return`${s}-content-${o}`}var us=He,Ze=Ue,er=Ye,rr=Qe;const ms=us,sr=d.forwardRef(({className:s,...o},a)=>e.jsx(Ze,{ref:a,className:K("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...o}));sr.displayName=Ze.displayName;const te=d.forwardRef(({className:s,...o},a)=>e.jsx(er,{ref:a,className:K("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...o}));te.displayName=er.displayName;const ie=d.forwardRef(({className:s,...o},a)=>e.jsx(rr,{ref:a,className:K("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...o}));ie.displayName=rr.displayName;const fs=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"];function Gs(){const s=je(),[o,a]=d.useState(!1),[t,c]=d.useState(null),[m,l]=d.useState(null),{data:i,isLoading:v}=se({queryKey:["availability-rules-admin"],queryFn:async()=>{const{data:u,error:p}=await P.from("availability_rules").select(`
          *,
          professionals(name),
          services(name)
        `).order("created_at",{ascending:!1});if(p)throw p;return u}}),h=(i==null?void 0:i.filter(u=>u.recurrence_type==="WEEKLY"))||[],r=(i==null?void 0:i.filter(u=>u.recurrence_type==="ONCE"))||[],n=ae({mutationFn:async({id:u,isActive:p})=>{const{error:F}=await P.from("availability_rules").update({is_active:p}).eq("id",u);if(F)throw F},onSuccess:()=>{s.invalidateQueries({queryKey:["availability-rules-admin"]}),M.success("Estado actualizado")},onError:()=>{M.error("Error al actualizar estado")}}),f=ae({mutationFn:async u=>{const{error:p}=await P.from("availability_rules").delete().eq("id",u);if(p)throw p},onSuccess:()=>{s.invalidateQueries({queryKey:["availability-rules-admin"]}),M.success("Regla eliminada"),l(null)},onError:()=>{M.error("Error al eliminar regla")}}),x=u=>{c(u),a(!0)},g=()=>{a(!1),c(null)},j=({data:u})=>e.jsxs(vr,{children:[e.jsx(hr,{children:e.jsxs(ee,{children:[e.jsx(D,{children:"Profesional"}),e.jsx(D,{children:"Servicio"}),e.jsx(D,{children:"Día/Fecha"}),e.jsx(D,{children:"Horario"}),e.jsx(D,{children:"Duración Slot"}),e.jsx(D,{children:"Activo"}),e.jsx(D,{className:"text-right",children:"Acciones"})]})}),e.jsx(gr,{children:u.length===0?e.jsx(ee,{children:e.jsx(S,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No hay reglas de disponibilidad"})}):u.map(p=>{var F;return e.jsxs(ee,{children:[e.jsx(S,{className:"font-medium text-foreground",children:p.professionals.name}),e.jsx(S,{className:"text-foreground",children:((F=p.services)==null?void 0:F.name)||"Todos"}),e.jsx(S,{className:"text-foreground",children:p.recurrence_type==="WEEKLY"?fs[p.day_of_week]:p.specific_date}),e.jsxs(S,{className:"text-foreground",children:[p.start_time," - ",p.end_time]}),e.jsxs(S,{className:"text-foreground",children:[p.duration_minutes," min"]}),e.jsx(S,{children:e.jsx(Tr,{checked:p.is_active,onCheckedChange:b=>n.mutate({id:p.id,isActive:b})})}),e.jsx(S,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>x(p),children:e.jsx(Gr,{className:"h-4 w-4"})}),e.jsx(L,{variant:"ghost",size:"sm",onClick:()=>l(p.id),children:e.jsx(Or,{className:"h-4 w-4 text-destructive"})})]})})]},p.id)})})]});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Gestión de Disponibilidad"}),e.jsxs(L,{onClick:()=>a(!0),children:[e.jsx(Mr,{className:"h-4 w-4 mr-2"}),"Nueva Regla"]})]}),v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(be,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(ms,{defaultValue:"weekly",children:[e.jsxs(sr,{children:[e.jsx(te,{value:"weekly",children:"Semanal"}),e.jsx(te,{value:"specific",children:"Fechas Específicas"})]}),e.jsx(ie,{value:"weekly",children:e.jsx(pe,{children:e.jsx(xe,{className:"p-0",children:e.jsx(j,{data:h})})})}),e.jsx(ie,{value:"specific",children:e.jsx(pe,{children:e.jsx(xe,{className:"p-0",children:e.jsx(j,{data:r})})})})]}),e.jsx(cs,{open:o,onClose:g,rule:t}),e.jsx(Er,{open:!!m,onOpenChange:()=>l(null),children:e.jsxs(Fr,{children:[e.jsxs(Nr,{children:[e.jsx(Sr,{children:"¿Eliminar regla de disponibilidad?"}),e.jsx(Ar,{children:"Esta acción no se puede deshacer. Se eliminará permanentemente la regla."})]}),e.jsxs(kr,{children:[e.jsx(Dr,{children:"Cancelar"}),e.jsx(Pr,{onClick:()=>m&&f.mutate(m),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})})]})}export{Gs as default};
