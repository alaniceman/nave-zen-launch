import{j as e,Z as w,_ as N,$ as C,a0 as _,I as g,B as j,s as f,g as x,W as P,r as v}from"./index-C5rgRvqo.js";import{u as q}from"./useQuery-0oj_cgUk.js";import{u as T}from"./useMutation-BV28fkb6.js";import{B as E}from"./badge-BjwLJHSd.js";import{T as F,a as L,b as h,c as t,d as A,e as i}from"./table-Dx8xmxs4.js";import{u as M}from"./index.esm-lhlJqsim.js";import{L as l}from"./label-BeSNDpt8.js";import{S as k,a as B,b as D,c as Q,d as S}from"./select-CEgrk5lk.js";import{T as z}from"./textarea-DcEA2ZHJ.js";import{P as I}from"./plus-Df2yDEAo.js";import{P as V}from"./pencil-CcLjUQJF.js";import"./index-DOQb1_gS.js";import"./index-D5h0ABJJ.js";import"./chevron-up-CiAXo2ej.js";import"./check-CfxDyft3.js";function H({plan:s,onClose:o,onSaved:d}){const{register:c,handleSubmit:n,setValue:m,watch:y,formState:{isSubmitting:u}}=M({defaultValues:{name:(s==null?void 0:s.name)||"",frequency:(s==null?void 0:s.frequency)||"monthly",classes_included:(s==null?void 0:s.classes_included)||4,price_clp:(s==null?void 0:s.price_clp)||0,description:(s==null?void 0:s.description)||""}}),b=async r=>{try{if(s){const{error:a}=await f.from("membership_plans").update(r).eq("id",s.id);if(a)throw a;x.success("Plan actualizado")}else{const{error:a}=await f.from("membership_plans").insert(r);if(a)throw a;x.success("Plan creado")}d()}catch(a){x.error(a.message||"Error al guardar")}};return e.jsx(w,{open:!0,onOpenChange:o,children:e.jsxs(N,{className:"sm:max-w-md",children:[e.jsx(C,{children:e.jsx(_,{children:s?"Editar Plan":"Nuevo Plan de Membresía"})}),e.jsxs("form",{onSubmit:n(b),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Nombre"}),e.jsx(g,{...c("name",{required:!0}),placeholder:"Ej: Universo"})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Frecuencia"}),e.jsxs(k,{value:y("frequency"),onValueChange:r=>m("frequency",r),children:[e.jsx(B,{children:e.jsx(D,{})}),e.jsxs(Q,{children:[e.jsx(S,{value:"weekly",children:"Semanal"}),e.jsx(S,{value:"monthly",children:"Mensual"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Clases incluidas"}),e.jsx(g,{type:"number",...c("classes_included",{valueAsNumber:!0})})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Precio (CLP)"}),e.jsx(g,{type:"number",...c("price_clp",{valueAsNumber:!0})})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Descripción (opcional)"}),e.jsx(z,{...c("description"),rows:2})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{type:"button",variant:"outline",onClick:o,children:"Cancelar"}),e.jsx(j,{type:"submit",disabled:u,children:u?"Guardando...":s?"Actualizar":"Crear"})]})]})]})})}function ie(){const s=P(),[o,d]=v.useState(null),[c,n]=v.useState(!1),{data:m=[],isLoading:y}=q({queryKey:["admin-membership-plans"],queryFn:async()=>{const{data:r,error:a}=await f.from("membership_plans").select("*").order("created_at",{ascending:!1});if(a)throw a;return r}}),u=T({mutationFn:async({id:r,is_active:a})=>{const{error:p}=await f.from("membership_plans").update({is_active:a}).eq("id",r);if(p)throw p},onSuccess:()=>{s.invalidateQueries({queryKey:["admin-membership-plans"]}),x.success("Plan actualizado")}}),b={weekly:"Semanal",monthly:"Mensual"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Planes de Membresía"}),e.jsxs(j,{onClick:()=>{d(null),n(!0)},children:[e.jsx(I,{className:"h-4 w-4 mr-1"})," Crear Plan"]})]}),e.jsx("div",{className:"bg-white rounded-lg border overflow-x-auto",children:e.jsxs(F,{children:[e.jsx(L,{children:e.jsxs(h,{children:[e.jsx(t,{children:"Nombre"}),e.jsx(t,{children:"Frecuencia"}),e.jsx(t,{children:"Clases"}),e.jsx(t,{children:"Precio"}),e.jsx(t,{children:"Estado"}),e.jsx(t,{})]})}),e.jsx(A,{children:y?e.jsx(h,{children:e.jsx(i,{colSpan:6,className:"text-center py-8 text-gray-500",children:"Cargando..."})}):m.length===0?e.jsx(h,{children:e.jsx(i,{colSpan:6,className:"text-center py-8 text-gray-500",children:"No hay planes creados"})}):m.map(r=>e.jsxs(h,{children:[e.jsx(i,{className:"font-medium",children:r.name}),e.jsx(i,{children:b[r.frequency]||r.frequency}),e.jsx(i,{children:r.classes_included}),e.jsxs(i,{children:["$",r.price_clp.toLocaleString("es-CL")]}),e.jsx(i,{children:e.jsx(E,{variant:"outline",className:r.is_active?"bg-green-100 text-green-700 cursor-pointer":"bg-gray-100 text-gray-500 cursor-pointer",onClick:()=>u.mutate({id:r.id,is_active:!r.is_active}),children:r.is_active?"Activo":"Inactivo"})}),e.jsx(i,{children:e.jsx(j,{size:"icon",variant:"ghost",onClick:()=>{d(r),n(!0)},children:e.jsx(V,{className:"h-4 w-4"})})})]},r.id))})]})}),c&&e.jsx(H,{plan:o,onClose:()=>n(!1),onSaved:()=>{n(!1),s.invalidateQueries({queryKey:["admin-membership-plans"]})}})]})}export{ie as default};
