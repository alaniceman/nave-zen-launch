import{c as I,W as R,r as a,s as N,j as e,f as y,L as w,B as o,H as z,g as c}from"./index-DZgJ29pE.js";import{C}from"./card-B25bVudG.js";import{F as v}from"./Footer-DpLvCSao.js";import{G as k}from"./gift-CI_MJoM0.js";import{C as T}from"./check-VtwSEAeH.js";import{D as B}from"./download-D3yUNacB.js";import{C as q}from"./calendar-C1zhn0wH.js";import{E as H}from"./external-link-xIl42WEp.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=I("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function Y(){const{token:t}=R(),[r,D]=a.useState(null),[L,E]=a.useState(!0),[m,x]=a.useState(null),[G,f]=a.useState(null),[h,p]=a.useState(!1);a.useEffect(()=>{t&&S()},[t]);const S=async()=>{try{const{data:s,error:n}=await N.functions.invoke("get-giftcard-data",{body:{token:t}});if(n)throw n;if(s.error){x(s.error);return}D({codes:s.codes,packageName:s.packageName,buyerName:s.buyerName,sessionsQuantity:s.sessionsQuantity,validityDays:s.validityDays,expiresAt:s.expiresAt,applicableServices:s.applicableServices})}catch(s){console.error("Error loading gift card:",s),x("Error al cargar la Gift Card")}finally{E(!1)}},F=async s=>{try{await navigator.clipboard.writeText(s),f(s),c.success("CÃ³digo copiado"),setTimeout(()=>f(null),2e3)}catch{c.error("Error al copiar")}},A=async()=>{if(!(!t||!r)){p(!0);try{const{data:s,error:n}=await N.functions.invoke("generate-giftcard-pdf",{body:{token:t}});if(n)throw n;const d=atob(s.pdf),g=new Array(d.length);for(let l=0;l<d.length;l++)g[l]=d.charCodeAt(l);const U=new Uint8Array(g),V=new Blob([U],{type:"application/pdf"}),b=URL.createObjectURL(V),i=document.createElement("a");i.href=b,i.download=`GiftCard-StudioLaNave-${r.packageName.replace(/\s+/g,"-")}.pdf`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(b),c.success("PDF descargado")}catch(s){console.error("Error downloading PDF:",s),c.error("Error al descargar el PDF")}finally{p(!1)}}},P=s=>new Date(s).toLocaleDateString("es-CL",{day:"numeric",month:"long",year:"numeric"});if(L)return e.jsx("main",{className:"min-h-screen pt-24 pb-16 px-4 flex items-center justify-center",children:e.jsx(y,{className:"h-8 w-8 animate-spin"})});if(m||!r)return e.jsxs(e.Fragment,{children:[e.jsx("main",{className:"min-h-screen pt-24 pb-16 px-4",children:e.jsxs("div",{className:"max-w-md mx-auto text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-destructive/10 mb-4",children:e.jsx(k,{className:"h-8 w-8 text-destructive"})}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Gift Card no encontrada"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:m||"El link de la Gift Card no es vÃ¡lido o ha expirado."}),e.jsx(w,{to:"/giftcards",children:e.jsx(o,{children:"Ver Gift Cards disponibles"})})]})}),e.jsx(v,{})]});const u=r.codes.filter(s=>!s.is_used),j=r.codes.filter(s=>s.is_used);return e.jsxs(e.Fragment,{children:[e.jsxs(z,{children:[e.jsx("title",{children:"Tu Gift Card - Studio La Nave"}),e.jsx("meta",{name:"robots",content:"noindex, nofollow"})]}),e.jsx("main",{className:"min-h-screen pt-24 pb-16 px-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-4",children:e.jsx(k,{className:"h-10 w-10 text-primary"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"ðŸŽ Gift Card"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:r.packageName})]}),e.jsxs(C,{className:"p-6 md:p-8 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"De parte de"}),e.jsx("p",{className:"font-semibold",children:r.buyerName})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"VÃ¡lido hasta"}),e.jsx("p",{className:"font-semibold",children:P(r.expiresAt)})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"CÃ³digos de sesiÃ³n"}),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",u.length," disponibles)"]})]}),e.jsxs("div",{className:"space-y-3",children:[u.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg border-2 border-dashed border-primary/30",children:[e.jsx("code",{className:"text-lg md:text-xl font-mono font-bold tracking-wider",children:s.code}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>F(s.code),children:G===s.code?e.jsx(T,{className:"h-4 w-4 text-green-600"}):e.jsx(O,{className:"h-4 w-4"})})]},s.code)),j.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"CÃ³digos usados:"}),j.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg opacity-60",children:[e.jsx("code",{className:"text-sm font-mono line-through",children:s.code}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Usado"})]},s.code))]})]})]}),r.applicableServices.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-primary/5 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"VÃ¡lido para:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.applicableServices.join(" â€¢ ")})]}),e.jsx(o,{onClick:A,disabled:h,className:"w-full",size:"lg",variant:"outline",children:h?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"h-4 w-4 animate-spin mr-2"}),"Generando PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Descargar Gift Card en PDF"]})})]}),e.jsxs(C,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Â¿CÃ³mo usar tus cÃ³digos?"}),e.jsxs("ol",{className:"space-y-3 text-sm",children:[e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:"1"}),e.jsx("span",{children:"Ve a la pÃ¡gina de reservas de Studio La Nave"})]}),e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:"2"}),e.jsx("span",{children:"Selecciona el profesional, fecha y hora que prefieras"})]}),e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:"3"}),e.jsx("span",{children:"Ingresa uno de tus cÃ³digos en el campo correspondiente"})]}),e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:"4"}),e.jsx("span",{children:"Â¡Tu sesiÃ³n quedarÃ¡ confirmada sin costo adicional!"})]})]}),e.jsx(w,{to:"/agenda-nave-studio",className:"block mt-6",children:e.jsxs(o,{className:"w-full",size:"lg",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Ir a reservar",e.jsx(H,{className:"h-4 w-4 ml-2"})]})})]})]})}),e.jsx(v,{})]})}export{Y as default};
