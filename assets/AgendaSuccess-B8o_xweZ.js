import{k as v,u as k,r as n,d as P,j as e,f as C,B as c,s as w}from"./index-CzR2IjBQ.js";import{C as o}from"./card-98WuJvoF.js";import{u as y}from"./useFacebookConversionsAPI-CQk1OlNW.js";import{C as _}from"./circle-x-ms7uLb6s.js";import{C as E}from"./clock-DJsMVFuQ.js";import{C as S}from"./circle-check-big-BZ1uP6O4.js";function M(){const[l]=v(),a=k(),[m,i]=n.useState(null),[g,j]=n.useState(!0),[d,b]=n.useState(!1),{trackEvent:u}=P(),{trackPurchase:x}=y();return n.useEffect(()=>{(async()=>{var f;const t=l.get("external_reference");if(t){const{data:r,error:R}=await w.from("bookings").select("status, customer_email, customer_name, customer_phone, final_price, services(name)").eq("id",t).maybeSingle();if(r){if(i(r.status),r.status==="CONFIRMED"&&!d){const s=r,h=((f=s.services)==null?void 0:f.name)||"Sesión",p=s.final_price||0,N=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;u("Purchase",{value:p,currency:"CLP",content_name:h,content_type:"product",content_ids:[t]},N),x({userEmail:s.customer_email,userName:s.customer_name,userPhone:s.customer_phone||void 0,value:p,currency:"CLP",contentName:h,orderId:t,eventId:N}),b(!0)}}else i("PENDING_PAYMENT")}else i("PENDING_PAYMENT");j(!1)})()},[l,d,u,x]),g?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(o,{className:"max-w-md w-full p-8 text-center",children:[e.jsx(C,{className:"h-16 w-16 text-primary mx-auto mb-4 animate-spin"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Verificando tu pago..."}),e.jsx("p",{className:"text-muted-foreground",children:"Por favor espera mientras confirmamos el estado de tu reserva."})]})}):m==="CANCELLED"?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(o,{className:"max-w-md w-full p-8 text-center",children:[e.jsx(_,{className:"h-16 w-16 text-destructive mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Pago Rechazado"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Lamentablemente tu pago no pudo ser procesado. Por favor intenta nuevamente con otro medio de pago."}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{onClick:()=>a("/agenda-nave-studio"),className:"w-full",children:"Intentar nuevamente"}),e.jsx(c,{onClick:()=>a("/"),variant:"outline",className:"w-full",children:"Volver al inicio"})]})]})}):m==="PENDING_PAYMENT"?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(o,{className:"max-w-md w-full p-8 text-center",children:[e.jsx(E,{className:"h-16 w-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Pago en Proceso"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Tu pago está siendo procesado. Recibirás un email de confirmación una vez que se complete."}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Si pagaste con transferencia bancaria, puede tomar hasta 24 horas en confirmarse."}),e.jsx(c,{onClick:()=>a("/"),className:"w-full",children:"Volver al inicio"})]})}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs(o,{className:"max-w-md w-full p-8 text-center",children:[e.jsx(S,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"¡Reserva Confirmada!"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Tu pago se ha procesado correctamente. Recibirás un email de confirmación con todos los detalles de tu sesión."}),e.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground mb-6",children:[e.jsx("p",{children:"Recuerda traer:"}),e.jsxs("ul",{className:"list-disc list-inside",children:[e.jsx("li",{children:"Traje de baño"}),e.jsx("li",{children:"Toalla grande"}),e.jsx("li",{children:"Bolsa para ropa mojada"})]}),e.jsx("p",{className:"mt-4",children:"Por favor llega puntual y en ayunas ligeras."})]}),e.jsx(c,{onClick:()=>a("/"),className:"w-full",children:"Volver al inicio"})]})})}export{M as default};
