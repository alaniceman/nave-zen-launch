import{V as T,r as b,j as e,Y as z,Z as I,_,$ as L,I as E,B as j,f as k,s as g,g as u}from"./index-DZgJ29pE.js";import{u as Q}from"./useQuery-Cz2LeAXE.js";import{u as S}from"./useMutation-6KN3B1wo.js";import{C as H,c as K}from"./card-B25bVudG.js";import{T as M,a as O,b as w,c as h,d as B,e as d}from"./table-BK2hRZHQ.js";import{u as R}from"./index.esm-kyqXXHc9.js";import{o as V,s as F,b as G,t as $}from"./zod-DRmRFH-_.js";import{F as U,a as p,b as v,c as y,d as C,e as P}from"./form-BAlrFiXM.js";import{C as Y,S as Z}from"./switch-BAjtLQMz.js";import{A as J,b as W,c as X,d as ee,e as se,f as ae,g as re,h as ie}from"./alert-dialog-3iDBAjjQ.js";import{P as ne}from"./plus-DMAXOVpl.js";import{P as te}from"./pencil-B3-WPuAv.js";import{T as le}from"./trash-2-BmiBsQfa.js";import"./label-BeAyWXnA.js";import"./index-D1kiJhbx.js";import"./check-VtwSEAeH.js";const oe=V({name:F().min(2,"El nombre debe tener al menos 2 caracteres").max(100),email:F().email("Email inválido"),slug:F().min(2,"El slug debe tener al menos 2 caracteres").max(100),isActive:G().default(!0)});function ce({open:f,onClose:x,professional:i}){const N=T(),l=!!i,r=R({resolver:$(oe),defaultValues:{name:"",email:"",slug:"",isActive:!0}});b.useEffect(()=>{i?r.reset({name:i.name,email:i.email,slug:i.slug,isActive:i.is_active}):r.reset({name:"",email:"",slug:"",isActive:!0})},[i,r]);const c=S({mutationFn:async s=>{const n={name:s.name,email:s.email,slug:s.slug,is_active:s.isActive};if(l){const{error:m}=await g.from("professionals").update(n).eq("id",i.id);if(m)throw m}else{const{error:m}=await g.from("professionals").insert(n);if(m)throw m}},onSuccess:()=>{N.invalidateQueries({queryKey:["professionals-admin"]}),u.success(l?"Profesional actualizado":"Profesional creado"),x()},onError:s=>{u.error(s.message||"Error al guardar profesional")}}),o=s=>{c.mutate(s)},A=s=>{if(!l){const n=s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"");r.setValue("slug",n)}};return e.jsx(z,{open:f,onOpenChange:x,children:e.jsxs(I,{className:"sm:max-w-md",children:[e.jsx(_,{children:e.jsx(L,{children:l?"Editar Profesional":"Nuevo Profesional"})}),e.jsx(U,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(o),className:"space-y-4",children:[e.jsx(p,{control:r.control,name:"name",render:({field:s})=>e.jsxs(v,{children:[e.jsx(y,{children:"Nombre"}),e.jsx(C,{children:e.jsx(E,{...s,onChange:n=>{s.onChange(n),A(n.target.value)},placeholder:"Sol García"})}),e.jsx(P,{})]})}),e.jsx(p,{control:r.control,name:"email",render:({field:s})=>e.jsxs(v,{children:[e.jsx(y,{children:"Email"}),e.jsx(C,{children:e.jsx(E,{...s,type:"email",placeholder:"sol@navestudio.cl"})}),e.jsx(P,{})]})}),e.jsx(p,{control:r.control,name:"slug",render:({field:s})=>e.jsxs(v,{children:[e.jsx(y,{children:"Slug (URL)"}),e.jsx(C,{children:e.jsx(E,{...s,placeholder:"sol-garcia"})}),e.jsx(P,{})]})}),e.jsx(p,{control:r.control,name:"isActive",render:({field:s})=>e.jsxs(v,{className:"flex items-center space-x-2",children:[e.jsx(C,{children:e.jsx(Y,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(y,{className:"!mt-0",children:"Activo"})]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(j,{type:"button",variant:"outline",onClick:x,children:"Cancelar"}),e.jsxs(j,{type:"submit",disabled:c.isPending,children:[c.isPending&&e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),l?"Actualizar":"Crear"]})]})]})})]})})}function we(){const f=T(),[x,i]=b.useState(!1),[N,l]=b.useState(null),[r,c]=b.useState(null),{data:o,isLoading:A}=Q({queryKey:["professionals-admin"],queryFn:async()=>{const{data:a,error:t}=await g.from("professionals").select("*").order("created_at",{ascending:!1});if(t)throw t;return a}}),s=S({mutationFn:async({id:a,isActive:t})=>{const{error:D}=await g.from("professionals").update({is_active:t}).eq("id",a);if(D)throw D},onSuccess:()=>{f.invalidateQueries({queryKey:["professionals-admin"]}),u.success("Estado actualizado")},onError:()=>{u.error("Error al actualizar estado")}}),n=S({mutationFn:async a=>{const{error:t}=await g.from("professionals").delete().eq("id",a);if(t)throw t},onSuccess:()=>{f.invalidateQueries({queryKey:["professionals-admin"]}),u.success("Profesional eliminado"),c(null)},onError:()=>{u.error("Error al eliminar profesional")}}),m=a=>{l(a),i(!0)},q=()=>{i(!1),l(null)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Gestión de Profesionales"}),e.jsxs(j,{onClick:()=>i(!0),children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Nuevo Profesional"]})]}),A?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(k,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx(H,{children:e.jsx(K,{className:"p-0",children:e.jsxs(M,{children:[e.jsx(O,{children:e.jsxs(w,{children:[e.jsx(h,{children:"Nombre"}),e.jsx(h,{children:"Email"}),e.jsx(h,{children:"Slug"}),e.jsx(h,{children:"Activo"}),e.jsx(h,{className:"text-right",children:"Acciones"})]})}),e.jsx(B,{children:(o==null?void 0:o.length)===0?e.jsx(w,{children:e.jsx(d,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"No hay profesionales registrados"})}):o==null?void 0:o.map(a=>e.jsxs(w,{children:[e.jsx(d,{className:"font-medium text-foreground",children:a.name}),e.jsx(d,{className:"text-foreground",children:a.email}),e.jsx(d,{className:"text-foreground font-mono text-sm",children:a.slug}),e.jsx(d,{children:e.jsx(Z,{checked:a.is_active,onCheckedChange:t=>s.mutate({id:a.id,isActive:t})})}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>m(a),children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>c(a.id),children:e.jsx(le,{className:"h-4 w-4 text-destructive"})})]})})]},a.id))})]})})}),e.jsx(ce,{open:x,onClose:q,professional:N}),e.jsx(J,{open:!!r,onOpenChange:()=>c(null),children:e.jsxs(W,{children:[e.jsxs(X,{children:[e.jsx(ee,{children:"¿Eliminar profesional?"}),e.jsx(se,{children:"Esta acción no se puede deshacer. Se eliminará permanentemente el profesional."})]}),e.jsxs(ae,{children:[e.jsx(re,{children:"Cancelar"}),e.jsx(ie,{onClick:()=>r&&n.mutate(r),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})})]})}export{we as default};
