import{c as V,W as I,r as n,j as e,f as N,L as y,B as c,H as R,s as w,g as d}from"./index-IYv-o_LZ.js";import{C}from"./card-BzXwkPKq.js";import{F as v}from"./Footer-Dd7bOLeh.js";import{G as k}from"./gift-Ci5YVrn-.js";import{C as z}from"./check-flsLmVj_.js";import{D as T}from"./download-TImcyGlN.js";import{C as B}from"./calendar-jynj2OqF.js";import{E as q}from"./external-link-CnDWQtTP.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=V("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function X(){const{token:i}=I(),[a,D]=n.useState(null),[L,G]=n.useState(!0),[m,x]=n.useState(null),[E,f]=n.useState(null),[h,p]=n.useState(!1);n.useEffect(()=>{if(!i)return;(async()=>{try{const{data:r,error:t}=await w.functions.invoke("get-giftcard-data",{body:{token:i}});if(t)throw t;if(r.error){x(r.error);return}D({codes:r.codes,packageName:r.packageName,buyerName:r.buyerName,sessionsQuantity:r.sessionsQuantity,validityDays:r.validityDays,expiresAt:r.expiresAt,applicableServices:r.applicableServices})}catch(r){console.error("Error loading gift card:",r),x("Error al cargar la Gift Card")}finally{G(!1)}})()},[i]);const S=async s=>{try{await navigator.clipboard.writeText(s),f(s),d.success("CÃ³digo copiado"),setTimeout(()=>f(null),2e3)}catch{d.error("Error al copiar")}},F=async()=>{if(!(!i||!a)){p(!0);try{const{data:s,error:r}=await w.functions.invoke("generate-giftcard-pdf",{body:{token:i}});if(r)throw r;const t=atob(s.pdf),g=new Array(t.length);for(let o=0;o<t.length;o++)g[o]=t.charCodeAt(o);const P=new Uint8Array(g),U=new Blob([P],{type:"application/pdf"}),b=URL.createObjectURL(U),l=document.createElement("a");l.href=b,l.download=`GiftCard-StudioLaNave-${a.packageName.replace(/\s+/g,"-")}.pdf`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(b),d.success("PDF descargado")}catch(s){console.error("Error downloading PDF:",s),d.error("Error al descargar el PDF")}finally{p(!1)}}},A=s=>new Date(s).toLocaleDateString("es-CL",{day:"numeric",month:"long",year:"numeric"});if(L)return e.jsx("main",{className:"min-h-screen pt-24 pb-16 px-4 flex items-center justify-center",children:e.jsx(N,{className:"h-8 w-8 animate-spin"})});if(m||!a)return e.jsxs(e.Fragment,{children:[e.jsx("main",{className:"min-h-screen pt-24 pb-16 px-4",children:e.jsxs("div",{className:"max-w-md mx-auto text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-destructive/10 mb-4",children:e.jsx(k,{className:"h-8 w-8 text-destructive"})}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Gift Card no encontrada"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:m||"El link de la Gift Card no es vÃ¡lido o ha expirado."}),e.jsx(y,{to:"/giftcards",children:e.jsx(c,{children:"Ver Gift Cards disponibles"})})]})}),e.jsx(v,{})]});const u=a.codes.filter(s=>!s.is_used),j=a.codes.filter(s=>s.is_used);return e.jsxs(e.Fragment,{children:[e.jsxs(R,{children:[e.jsx("title",{children:"Tu Gift Card - Studio La Nave"}),e.jsx("meta",{name:"robots",content:"noindex, nofollow"})]}),e.jsx("main",{className:"min-h-screen pt-24 pb-16 px-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-primary/20 to-primary/10 mb-4",children:e.jsx(k,{className:"h-10 w-10 text-primary"})}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2",children:"ðŸŽ Gift Card"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:a.packageName})]}),e.jsxs(C,{className:"p-6 md:p-8 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"De parte de"}),e.jsx("p",{className:"font-semibold",children:a.buyerName})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"VÃ¡lido hasta"}),e.jsx("p",{className:"font-semibold",children:A(a.expiresAt)})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"font-semibold mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"CÃ³digos de sesiÃ³n"}),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",u.length," disponibles)"]})]}),e.jsxs("div",{className:"space-y-3",children:[u.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg border-2 border-dashed border-primary/30",children:[e.jsx("code",{className:"text-lg md:text-xl font-mono font-bold tracking-wider",children:s.code}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>S(s.code),children:E===s.code?e.jsx(z,{className:"h-4 w-4 text-green-600"}):e.jsx(H,{className:"h-4 w-4"})})]},s.code)),j.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"CÃ³digos usados:"}),j.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/30 rounded-lg opacity-60",children:[e.jsx("code",{className:"text-sm font-mono line-through",children:s.code}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Usado"})]},s.code))]})]})]}),a.applicableServices.length>0&&e.jsxs("div",{className:"mb-6 p-4 bg-primary/5 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"VÃ¡lido para:"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.applicableServices.join(" â€¢ ")})]}),e.jsx(c,{onClick:F,disabled:h,className:"w-full",size:"lg",variant:"outline",children:h?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 animate-spin mr-2"}),"Generando PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Descargar Gift Card en PDF"]})})]}),e.jsxs(C,{className:"p-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Â¿CÃ³mo usar tus cÃ³digos?"}),e.jsxs("ol",{className:"space-y-3 text-sm",children:[e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:"1"}),e.jsx("span",{children:"Ve a la pÃ¡gina de reservas de Studio La Nave"})]}),e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:"2"}),e.jsx("span",{children:"Selecciona el profesional, fecha y hora que prefieras"})]}),e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:"3"}),e.jsx("span",{children:"Ingresa uno de tus cÃ³digos en el campo correspondiente"})]}),e.jsxs("li",{className:"flex gap-3",children:[e.jsx("span",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:"4"}),e.jsx("span",{children:"Â¡Tu sesiÃ³n quedarÃ¡ confirmada sin costo adicional!"})]})]}),e.jsx(y,{to:"/agenda-nave-studio",className:"block mt-6",children:e.jsxs(c,{className:"w-full",size:"lg",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Ir a reservar",e.jsx(q,{className:"h-4 w-4 ml-2"})]})})]})]})}),e.jsx(v,{})]})}export{X as default};
