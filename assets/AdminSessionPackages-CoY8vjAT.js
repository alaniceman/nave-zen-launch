import{r as t,s as n,g as c,j as e,Y as S,aD as D,B as o,Z as E,_ as F,$ as z,I as m}from"./index-DZgJ29pE.js";import{C as L}from"./card-B25bVudG.js";import{L as l}from"./label-BeAyWXnA.js";import{T}from"./textarea-3DxZ9G3h.js";import{C as A,S as _}from"./switch-BAjtLQMz.js";import{P as I}from"./plus-DMAXOVpl.js";import{P as k}from"./pencil-B3-WPuAv.js";import{T as M}from"./trash-2-BmiBsQfa.js";import"./index-D1kiJhbx.js";import"./check-VtwSEAeH.js";function J(){const[j,v]=t.useState([]),[f,g]=t.useState([]),[y,h]=t.useState(!1),[d,x]=t.useState(null),[i,r]=t.useState({name:"",description:"",sessions_quantity:1,price_clp:0,validity_days:90,applicable_service_ids:[],is_active:!0,available_as_giftcard:!1,show_in_upsell_modal:!1,show_in_criomedicina:!1});t.useEffect(()=>{u(),b()},[]);const u=async()=>{const{data:s,error:a}=await n.from("session_packages").select("*").order("sessions_quantity");if(a){c.error("Error al cargar paquetes");return}v(s||[])},b=async()=>{const{data:s,error:a}=await n.from("services").select("id, name").eq("is_active",!0);if(a){c.error("Error al cargar servicios");return}g(s||[])},w=async s=>{if(s.preventDefault(),d){const{error:a}=await n.from("session_packages").update(i).eq("id",d.id);if(a){c.error("Error al actualizar paquete");return}c.success("Paquete actualizado")}else{const{error:a}=await n.from("session_packages").insert([i]);if(a){c.error("Error al crear paquete");return}c.success("Paquete creado")}h(!1),p(),u()},C=async s=>{if(!confirm("¿Estás seguro de eliminar este paquete?"))return;const{error:a}=await n.from("session_packages").delete().eq("id",s);if(a){c.error("Error al eliminar paquete");return}c.success("Paquete eliminado"),u()},N=s=>{x(s),r({name:s.name,description:s.description,sessions_quantity:s.sessions_quantity,price_clp:s.price_clp,validity_days:s.validity_days,applicable_service_ids:s.applicable_service_ids,is_active:s.is_active,available_as_giftcard:s.available_as_giftcard??!1,show_in_upsell_modal:s.show_in_upsell_modal??!1,show_in_criomedicina:s.show_in_criomedicina??!1}),h(!0)},p=()=>{x(null),r({name:"",description:"",sessions_quantity:1,price_clp:0,validity_days:90,applicable_service_ids:[],is_active:!0,available_as_giftcard:!1,show_in_upsell_modal:!1,show_in_criomedicina:!1})},q=s=>{r(a=>({...a,applicable_service_ids:a.applicable_service_ids.includes(s)?a.applicable_service_ids.filter(P=>P!==s):[...a.applicable_service_ids,s]}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Paquetes de Sesiones"}),e.jsxs(S,{open:y,onOpenChange:s=>{h(s),s||p()},children:[e.jsx(D,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Nuevo Paquete"]})}),e.jsxs(E,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(F,{children:e.jsx(z,{children:d?"Editar Paquete":"Nuevo Paquete"})}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",children:"Nombre *"}),e.jsx(m,{id:"name",value:i.name,onChange:s=>r({...i,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"description",children:"Descripción"}),e.jsx(T,{id:"description",value:i.description,onChange:s=>r({...i,description:s.target.value}),rows:3})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"sessions_quantity",children:"Cantidad de Sesiones *"}),e.jsx(m,{id:"sessions_quantity",type:"number",min:"1",value:i.sessions_quantity,onChange:s=>r({...i,sessions_quantity:parseInt(s.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"price_clp",children:"Precio (CLP) *"}),e.jsx(m,{id:"price_clp",type:"number",min:"0",value:i.price_clp,onChange:s=>r({...i,price_clp:parseInt(s.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"validity_days",children:"Validez (días) *"}),e.jsx(m,{id:"validity_days",type:"number",min:"1",value:i.validity_days,onChange:s=>r({...i,validity_days:parseInt(s.target.value)}),required:!0})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"mb-3 block",children:"Servicios Aplicables *"}),e.jsx("div",{className:"space-y-2 border rounded-lg p-4",children:f.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:s.id,checked:i.applicable_service_ids.includes(s.id),onCheckedChange:()=>q(s.id)}),e.jsx("label",{htmlFor:s.id,className:"text-sm cursor-pointer",children:s.name})]},s.id))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:"is_active",checked:i.is_active,onCheckedChange:s=>r({...i,is_active:s})}),e.jsx(l,{htmlFor:"is_active",children:"Activo"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:"available_as_giftcard",checked:i.available_as_giftcard,onCheckedChange:s=>r({...i,available_as_giftcard:s})}),e.jsx(l,{htmlFor:"available_as_giftcard",children:"Disponible como Gift Card"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:"show_in_upsell_modal",checked:i.show_in_upsell_modal,onCheckedChange:s=>r({...i,show_in_upsell_modal:s})}),e.jsx(l,{htmlFor:"show_in_upsell_modal",children:"Mostrar en modal de upsell (agenda)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:"show_in_criomedicina",checked:i.show_in_criomedicina,onCheckedChange:s=>r({...i,show_in_criomedicina:s})}),e.jsx(l,{htmlFor:"show_in_criomedicina",children:"Mostrar en página Criomedicina"})]}),e.jsxs(o,{type:"submit",className:"w-full",children:[d?"Actualizar":"Crear"," Paquete"]})]})]})]})]}),e.jsx("div",{className:"grid gap-4",children:j.map(s=>e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description}),e.jsxs("div",{className:"mt-3 space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Sesiones:"})," ",s.sessions_quantity]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Precio:"})," $",s.price_clp.toLocaleString("es-CL")," CLP"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Validez:"})," ",s.validity_days," días"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Estado:"})," ",s.is_active?"Activo":"Inactivo"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gift Card:"})," ",s.available_as_giftcard?"✅ Sí":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Modal Upsell:"})," ",s.show_in_upsell_modal?"✅ Sí":"No"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Página Criomedicina:"})," ",s.show_in_criomedicina?"✅ Sí":"No"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>N(s),children:e.jsx(k,{className:"h-4 w-4"})}),e.jsx(o,{size:"sm",variant:"destructive",onClick:()=>C(s.id),children:e.jsx(M,{className:"h-4 w-4"})})]})]})},s.id))})]})}export{J as default};
