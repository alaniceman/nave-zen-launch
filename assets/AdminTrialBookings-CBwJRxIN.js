import{r as o,j as e,B as n,I as H,s as b,g as f}from"./index-IYv-o_LZ.js";import{C as h,a as p,b as N,c as u}from"./card-BzXwkPKq.js";import{T as F,a as M,b as j,c as t,d as $,e as a}from"./table-l1OCyKq7.js";import{B as I}from"./badge-D7z4mQ5S.js";import{S as R,a as q,b as L,c as V,d}from"./select-CqgsOY3A.js";import{R as D}from"./refresh-cw-BmYug5SF.js";import{C as O}from"./clock-CQD_j3mZ.js";import{C as P}from"./circle-check-big-dL5OspA7.js";import{C as X}from"./circle-x-D_PClhp7.js";import{S as G}from"./search-dXZmVU6J.js";import{k as y,n as J}from"./es-BGq_Vek6.js";import{p as v}from"./parseISO-B7l4lJ9E.js";import"./index-xHwMhLcE.js";import"./index-D0po66-R.js";import"./chevron-down-CaUqBoSJ.js";import"./chevron-up-CDSinjhX.js";import"./check-flsLmVj_.js";const K={booked:"bg-blue-100 text-blue-800",attended:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",no_show:"bg-yellow-100 text-yellow-800"},w={booked:"Agendada",attended:"Asistió",cancelled:"Cancelada",no_show:"No asistió"};function xe(){const[l,_]=o.useState([]),[k,C]=o.useState(!0),[r,S]=o.useState(""),[i,T]=o.useState("all"),m=async()=>{C(!0);let s=b.from("trial_bookings").select("*").order("created_at",{ascending:!1});i!=="all"&&(s=s.eq("status",i)),r&&(s=s.or(`customer_name.ilike.%${r}%,customer_email.ilike.%${r}%,customer_phone.ilike.%${r}%`));const{data:x,error:c}=await s.limit(100);c?(f.error("Error cargando clases de prueba"),console.error(c)):_(x||[]),C(!1)};o.useEffect(()=>{m()},[i]);const g=async(s,x)=>{const{error:c}=await b.from("trial_bookings").update({status:x}).eq("id",s);c?(f.error("Error actualizando estado"),console.error(c)):(f.success(`Estado actualizado a "${w[x]}"`),m())},A=s=>{s.preventDefault(),m()},B=l.filter(s=>s.status==="booked").length,z=l.filter(s=>s.status==="attended").length,E=l.filter(s=>s.status==="cancelled").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Clases de Prueba"}),e.jsxs(n,{variant:"outline",size:"sm",onClick:m,children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Actualizar"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(h,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(N,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4"})," Agendadas"]})}),e.jsx(u,{children:e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:B})})]}),e.jsxs(h,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(N,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"})," Asistieron"]})}),e.jsx(u,{children:e.jsx("p",{className:"text-2xl font-bold text-green-600",children:z})})]}),e.jsxs(h,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(N,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"})," Canceladas"]})}),e.jsx(u,{children:e.jsx("p",{className:"text-2xl font-bold text-red-600",children:E})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("form",{onSubmit:A,className:"flex gap-2 flex-1",children:[e.jsx(H,{placeholder:"Buscar por nombre, email o teléfono...",value:r,onChange:s=>S(s.target.value),className:"max-w-sm"}),e.jsx(n,{type:"submit",variant:"outline",size:"icon",children:e.jsx(G,{className:"h-4 w-4"})})]}),e.jsxs(R,{value:i,onValueChange:T,children:[e.jsx(q,{className:"w-[180px]",children:e.jsx(L,{placeholder:"Filtrar por estado"})}),e.jsxs(V,{children:[e.jsx(d,{value:"all",children:"Todos"}),e.jsx(d,{value:"booked",children:"Agendadas"}),e.jsx(d,{value:"attended",children:"Asistieron"}),e.jsx(d,{value:"cancelled",children:"Canceladas"}),e.jsx(d,{value:"no_show",children:"No asistieron"})]})]})]}),e.jsx(h,{children:e.jsx(u,{className:"p-0",children:e.jsxs(F,{children:[e.jsx(M,{children:e.jsxs(j,{children:[e.jsx(t,{children:"Nombre"}),e.jsx(t,{children:"Email"}),e.jsx(t,{children:"Teléfono"}),e.jsx(t,{children:"Clase"}),e.jsx(t,{children:"Fecha"}),e.jsx(t,{children:"Hora"}),e.jsx(t,{children:"Estado"}),e.jsx(t,{children:"Fuente"}),e.jsx(t,{children:"Creado"}),e.jsx(t,{children:"Acciones"})]})}),e.jsx($,{children:k?e.jsx(j,{children:e.jsx(a,{colSpan:10,className:"text-center py-8 text-muted-foreground",children:"Cargando..."})}):l.length===0?e.jsx(j,{children:e.jsx(a,{colSpan:10,className:"text-center py-8 text-muted-foreground",children:"No hay clases de prueba registradas"})}):l.map(s=>e.jsxs(j,{children:[e.jsx(a,{className:"font-medium",children:s.customer_name}),e.jsx(a,{className:"text-sm",children:s.customer_email}),e.jsx(a,{className:"text-sm",children:s.customer_phone}),e.jsx(a,{className:"text-sm",children:s.class_title}),e.jsx(a,{className:"text-sm",children:s.scheduled_date?y(v(s.scheduled_date),"dd MMM yyyy",{locale:J}):s.class_day}),e.jsx(a,{className:"text-sm",children:s.class_time}),e.jsx(a,{children:e.jsx(I,{className:K[s.status]||"bg-gray-100 text-gray-800",children:w[s.status]||s.status})}),e.jsx(a,{className:"text-sm",children:s.utm_source?`${s.utm_source}`:s.source}),e.jsx(a,{className:"text-sm text-muted-foreground",children:y(v(s.created_at),"dd/MM HH:mm")}),e.jsx(a,{children:e.jsxs("div",{className:"flex gap-1",children:[s.status!=="attended"&&e.jsx(n,{size:"sm",variant:"outline",className:"text-green-700 border-green-300 hover:bg-green-50 h-7 text-xs",onClick:()=>g(s.id,"attended"),children:"Asistió"}),s.status!=="cancelled"&&e.jsx(n,{size:"sm",variant:"outline",className:"text-red-700 border-red-300 hover:bg-red-50 h-7 text-xs",onClick:()=>g(s.id,"cancelled"),children:"Cancelar"}),s.status!=="no_show"&&s.status!=="attended"&&e.jsx(n,{size:"sm",variant:"outline",className:"text-yellow-700 border-yellow-300 hover:bg-yellow-50 h-7 text-xs",onClick:()=>g(s.id,"no_show"),children:"No asistió"})]})})]},s.id))})]})})})]})}export{xe as default};
