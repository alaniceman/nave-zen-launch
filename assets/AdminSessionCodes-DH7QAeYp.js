import{c as T,r,s as y,g as p,j as e,B as N,I as A}from"./index-C5rgRvqo.js";import{C as v}from"./card-CA0XCuJa.js";import{L as w}from"./label-BeSNDpt8.js";import{B as h}from"./badge-BjwLJHSd.js";import{S as F,a as H,b as I,c as q,d as m}from"./select-CEgrk5lk.js";import{D as V}from"./download-jNIxu8UT.js";import{S as R}from"./search-KxhbYejk.js";import{k as n,n as d}from"./es-BGq_Vek6.js";import"./index-DOQb1_gS.js";import"./index-D5h0ABJJ.js";import"./chevron-up-CiAXo2ej.js";import"./check-CfxDyft3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=T("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);function se(){const[j,b]=r.useState([]),[c,C]=r.useState([]),[i,_]=r.useState(""),[l,S]=r.useState("all"),[D,u]=r.useState(!0);r.useEffect(()=>{f()},[]),r.useEffect(()=>{E()},[j,i,l]);const f=async()=>{u(!0);const{data:s,error:a}=await y.from("session_codes").select("*, session_packages(name)").order("purchased_at",{ascending:!1});if(a){p.error("Error al cargar códigos"),u(!1);return}b(s||[]),u(!1)},E=()=>{let s=j;if(i&&(s=s.filter(a=>a.code.toLowerCase().includes(i.toLowerCase())||a.buyer_email.toLowerCase().includes(i.toLowerCase())||a.buyer_name.toLowerCase().includes(i.toLowerCase()))),l==="used")s=s.filter(a=>a.is_used);else if(l==="unused")s=s.filter(a=>!a.is_used);else if(l==="expired"){const a=new Date;s=s.filter(o=>!o.is_used&&new Date(o.expires_at)<a)}C(s)},M=()=>{const s=["Código","Comprador","Email","Teléfono","Paquete","Comprado","Expira","Estado","Usado en"],a=c.map(t=>{var g;return[t.code,t.buyer_name,t.buyer_email,t.buyer_phone,((g=t.session_packages)==null?void 0:g.name)||"N/A",n(new Date(t.purchased_at),"dd/MM/yyyy HH:mm",{locale:d}),n(new Date(t.expires_at),"dd/MM/yyyy",{locale:d}),t.is_used?"Usado":"Disponible",t.used_at?n(new Date(t.used_at),"dd/MM/yyyy HH:mm",{locale:d}):"N/A"]}),o=[s,...a].map(t=>t.join(",")).join(`
`),B=new Blob([o],{type:"text/csv"}),U=window.URL.createObjectURL(B),x=document.createElement("a");x.href=U,x.download=`codigos-sesiones-${n(new Date,"yyyy-MM-dd")}.csv`,x.click()},L=async s=>{if(!confirm(`¿Marcar el código ${s.code} como usado? Esto es equivalente a que la persona asistió.`))return;const{error:a}=await y.from("session_codes").update({is_used:!0,used_at:new Date().toISOString()}).eq("id",s.id);if(a){p.error("Error al desactivar el código");return}p.success(`Código ${s.code} marcado como usado`),f()},k=s=>{if(s.is_used)return e.jsx(h,{variant:"secondary",children:"Usado"});const a=new Date,o=new Date(s.expires_at);return a>o?e.jsx(h,{variant:"destructive",children:"Expirado"}):e.jsx(h,{variant:"default",children:"Disponible"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Códigos de Sesión"}),e.jsxs(N,{onClick:M,variant:"outline",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Exportar CSV"]})]}),e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx(w,{htmlFor:"search",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(A,{id:"search",placeholder:"Código, email, nombre...",value:i,onChange:s=>_(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx(w,{htmlFor:"status",children:"Estado"}),e.jsxs(F,{value:l,onValueChange:S,children:[e.jsx(H,{id:"status",children:e.jsx(I,{})}),e.jsxs(q,{children:[e.jsx(m,{value:"all",children:"Todos"}),e.jsx(m,{value:"unused",children:"Disponibles"}),e.jsx(m,{value:"used",children:"Usados"}),e.jsx(m,{value:"expired",children:"Expirados"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:c.length})]})})]}),e.jsx("div",{className:"space-y-4",children:D?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Cargando..."}):c.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No se encontraron códigos"}):c.map(s=>{var a;return e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"grid md:grid-cols-5 gap-4 items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Código"}),e.jsx("p",{className:"font-mono font-bold text-lg",children:s.code}),k(s)]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Comprador"}),e.jsx("p",{className:"font-semibold",children:s.buyer_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.buyer_email}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.buyer_phone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Paquete"}),e.jsx("p",{className:"text-sm font-medium",children:((a=s.session_packages)==null?void 0:a.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Fechas"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Comprado:"})," ",n(new Date(s.purchased_at),"dd/MM/yyyy",{locale:d})]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Expira:"})," ",n(new Date(s.expires_at),"dd/MM/yyyy",{locale:d})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Uso"}),s.is_used?e.jsx("p",{className:"text-sm",children:n(new Date(s.used_at),"dd/MM/yyyy HH:mm",{locale:d})}):e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>L(s),className:"mt-1",children:[e.jsx($,{className:"h-3 w-3 mr-1"}),"Marcar usado"]})]})]})},s.id)})})]})]})}export{se as default};
