import{V as H,r as T,j as e,Y as V,Z as R,_ as Y,$,I as v,B as y,f as B,s as C,g as f,a1 as G}from"./index-DgMpF62C.js";import{u as K}from"./useQuery-BTxbnbv1.js";import{u as k}from"./useMutation-CWL1BRlX.js";import{C as W,c as X}from"./card-C8hB7ibz.js";import{T as Z,a as J,b as E,c as h,d as U,e as u}from"./table-BxbxVbda.js";import{u as ee}from"./index.esm-CwA3zrSh.js";import{o as se,s as S,n as _,b as D,t as ae}from"./zod-yqzwEcrb.js";import{F as re,a as o,b as l,c,d,e as j}from"./form-AJ9sHeNs.js";import{T as ne}from"./textarea-B0Ys_jSz.js";import{C as F,S as ie}from"./switch-763QSF6w.js";import{S as O,a as q,b as P,c as z,d as L}from"./select-8dj-i9Ck.js";import{A as te,b as oe,c as le,d as ce,e as de,f as me,g as xe,h as ue}from"./alert-dialog-B10pn27x.js";import{P as he}from"./plus-C3tBHcL7.js";import{P as je}from"./pencil-FWxgCYvq.js";import{T as pe}from"./trash-2-DAp8J_5G.js";import{C as ge}from"./check-ChRAgIYV.js";import"./label-CE2J_Qba.js";import"./index-DJwoYwHJ.js";import"./index-B-Iwk0i_.js";import"./chevron-down-DGyKDyC-.js";import"./chevron-up-BWEP_Trh.js";const fe=[{value:"yoga",label:"Yoga"},{value:"wim-hof",label:"Método Wim Hof"},{value:"hiit",label:"HIIT / Biohacking"},{value:"breathwork",label:"Breathwork"},{value:"personalizado",label:"Personalizado"},{value:"default",label:"Default"}],Ce=se({name:S().min(2,"El nombre debe tener al menos 2 caracteres"),description:S().optional(),branchId:S().min(1,"Selecciona una sucursal"),durationMinutes:_().min(15,"Mínimo 15 minutos").max(480,"Máximo 480 minutos"),priceClp:_().min(0,"El precio mínimo es $0"),maxCapacity:_().min(1,"Mínimo 1 cupo").max(100,"Máximo 100 cupos"),sortOrder:_().min(0,"Mínimo 0").default(0),isActive:D().default(!0),isTrialEnabled:D().default(!1),showInAgenda:D().default(!0),colorTag:S().default("default")});function be({open:N,onClose:b,service:i}){const A=H(),p=!!i,{data:t}=K({queryKey:["branches-admin"],queryFn:async()=>{const{data:s,error:a}=await C.from("branches").select("*").order("sort_order",{ascending:!0});if(a)throw a;return s}}),n=ee({resolver:ae(Ce),defaultValues:{name:"",description:"",branchId:"",durationMinutes:60,priceClp:25e3,maxCapacity:6,sortOrder:0,isActive:!0,isTrialEnabled:!1,showInAgenda:!0,colorTag:"default"}});T.useEffect(()=>{if(i)n.reset({name:i.name,description:i.description||"",branchId:i.branch_id||"",durationMinutes:i.duration_minutes,priceClp:i.price_clp,maxCapacity:i.max_capacity,sortOrder:i.sort_order??0,isActive:i.is_active,isTrialEnabled:i.is_trial_enabled??!1,showInAgenda:i.show_in_agenda??!0,colorTag:i.color_tag||"default"});else{const s=t==null?void 0:t.find(a=>a.is_default);n.reset({name:"",description:"",branchId:(s==null?void 0:s.id)||"",durationMinutes:60,priceClp:25e3,maxCapacity:6,sortOrder:0,isActive:!0,isTrialEnabled:!1,showInAgenda:!0,colorTag:"default"})}},[i,n,t]);const m=k({mutationFn:async s=>{const a={name:s.name,description:s.description||null,branch_id:s.branchId,duration_minutes:s.durationMinutes,price_clp:s.priceClp,max_capacity:s.maxCapacity,sort_order:s.sortOrder,is_active:s.isActive,is_trial_enabled:s.isTrialEnabled,show_in_agenda:s.showInAgenda,color_tag:s.colorTag};if(p){const{error:g}=await C.from("services").update(a).eq("id",i.id);if(g)throw g}else{const{error:g}=await C.from("services").insert(a);if(g)throw g}},onSuccess:()=>{A.invalidateQueries({queryKey:["services-admin"]}),f.success(p?"Servicio actualizado":"Servicio creado"),b()},onError:s=>{f.error(s.message||"Error al guardar servicio")}}),I=s=>{m.mutate(s)};return e.jsx(V,{open:N,onOpenChange:b,children:e.jsxs(R,{className:"sm:max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsx($,{children:p?"Editar Servicio":"Nuevo Servicio"})}),e.jsx(re,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(I),className:"space-y-4",children:[e.jsx(o,{control:n.control,name:"name",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Nombre"}),e.jsx(d,{children:e.jsx(v,{...s,placeholder:"Clase de Yoga"})}),e.jsx(j,{})]})}),e.jsx(o,{control:n.control,name:"branchId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Sucursal"}),e.jsxs(O,{onValueChange:s.onChange,value:s.value,children:[e.jsx(d,{children:e.jsx(q,{children:e.jsx(P,{placeholder:"Selecciona una sucursal"})})}),e.jsx(z,{children:t==null?void 0:t.map(a=>e.jsx(L,{value:a.id,children:a.name},a.id))})]}),e.jsx(j,{})]})}),e.jsx(o,{control:n.control,name:"description",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Descripción (opcional)"}),e.jsx(d,{children:e.jsx(ne,{...s,placeholder:"Descripción del servicio...",rows:3})}),e.jsx(j,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:n.control,name:"durationMinutes",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Duración (min)"}),e.jsx(d,{children:e.jsx(v,{...s,type:"number",onChange:a=>s.onChange(parseInt(a.target.value))})}),e.jsx(j,{})]})}),e.jsx(o,{control:n.control,name:"priceClp",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Precio (CLP)"}),e.jsx(d,{children:e.jsx(v,{...s,type:"number",onChange:a=>s.onChange(parseInt(a.target.value))})}),e.jsx(j,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:n.control,name:"maxCapacity",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Cupos"}),e.jsx(d,{children:e.jsx(v,{...s,type:"number",onChange:a=>s.onChange(parseInt(a.target.value))})}),e.jsx(j,{})]})}),e.jsx(o,{control:n.control,name:"sortOrder",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Orden"}),e.jsx(d,{children:e.jsx(v,{...s,type:"number",onChange:a=>s.onChange(parseInt(a.target.value)||0)})}),e.jsx(j,{})]})})]}),e.jsx(o,{control:n.control,name:"colorTag",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Categoría de color"}),e.jsxs(O,{onValueChange:s.onChange,value:s.value,children:[e.jsx(d,{children:e.jsx(q,{children:e.jsx(P,{})})}),e.jsx(z,{children:fe.map(a=>e.jsx(L,{value:a.value,children:a.label},a.value))})]}),e.jsx(j,{})]})}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsx(o,{control:n.control,name:"isActive",render:({field:s})=>e.jsxs(l,{className:"flex items-center space-x-2",children:[e.jsx(d,{children:e.jsx(F,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(c,{className:"!mt-0",children:"Activo"})]})}),e.jsx(o,{control:n.control,name:"isTrialEnabled",render:({field:s})=>e.jsxs(l,{className:"flex items-center space-x-2",children:[e.jsx(d,{children:e.jsx(F,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(c,{className:"!mt-0",children:"Disponible como clase de prueba"})]})}),e.jsx(o,{control:n.control,name:"showInAgenda",render:({field:s})=>e.jsxs(l,{className:"flex items-center space-x-2",children:[e.jsx(d,{children:e.jsx(F,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(c,{className:"!mt-0",children:"Mostrar en calendario de agenda"})]})})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(y,{type:"button",variant:"outline",onClick:b,children:"Cancelar"}),e.jsxs(y,{type:"submit",disabled:m.isPending,children:[m.isPending&&e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"}),p?"Actualizar":"Crear"]})]})]})})]})})}function Ke(){const N=H(),[b,i]=T.useState(!1),[A,p]=T.useState(null),[t,n]=T.useState(null),{data:m,isLoading:I}=K({queryKey:["services-admin"],queryFn:async()=>{const{data:r,error:x}=await C.from("services").select("*, branches(id, name)").order("sort_order",{ascending:!0});if(x)throw x;return r}}),s=k({mutationFn:async({id:r,isActive:x})=>{const{error:w}=await C.from("services").update({is_active:x}).eq("id",r);if(w)throw w},onSuccess:()=>{N.invalidateQueries({queryKey:["services-admin"]}),f.success("Estado actualizado")},onError:()=>{f.error("Error al actualizar estado")}}),a=k({mutationFn:async r=>{const{error:x}=await C.from("services").delete().eq("id",r);if(x)throw x},onSuccess:()=>{N.invalidateQueries({queryKey:["services-admin"]}),f.success("Servicio eliminado"),n(null)},onError:()=>{f.error("Error al eliminar servicio")}}),g=r=>{p(r),i(!0)},Q=()=>{i(!1),p(null)},M=({value:r})=>r?e.jsx(ge,{className:"h-4 w-4 text-emerald-600"}):e.jsx(G,{className:"h-4 w-4 text-muted-foreground"});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Gestión de Servicios"}),e.jsxs(y,{onClick:()=>i(!0),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Nuevo Servicio"]})]}),I?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(B,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx(W,{children:e.jsx(X,{className:"p-0",children:e.jsxs(Z,{children:[e.jsx(J,{children:e.jsxs(E,{children:[e.jsx(h,{className:"w-14",children:"#"}),e.jsx(h,{children:"Nombre"}),e.jsx(h,{children:"Sucursal"}),e.jsx(h,{className:"w-20",children:"Duración"}),e.jsx(h,{className:"w-24",children:"Precio"}),e.jsx(h,{className:"w-16 text-center",children:"Prueba"}),e.jsx(h,{className:"w-16 text-center",children:"Agenda"}),e.jsx(h,{className:"w-16 text-center",children:"Activo"}),e.jsx(h,{className:"text-right w-24",children:"Acciones"})]})}),e.jsx(U,{children:(m==null?void 0:m.length)===0?e.jsx(E,{children:e.jsx(u,{colSpan:9,className:"text-center py-8 text-muted-foreground",children:"No hay servicios registrados"})}):m==null?void 0:m.map(r=>{var x;return e.jsxs(E,{children:[e.jsx(u,{className:"text-foreground font-medium",children:r.sort_order??0}),e.jsxs(u,{children:[e.jsx("div",{className:"font-medium text-foreground",children:r.name}),r.description&&e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",children:r.description})]}),e.jsx(u,{className:"text-muted-foreground",children:((x=r.branches)==null?void 0:x.name)||"-"}),e.jsxs(u,{className:"text-foreground",children:[r.duration_minutes," min"]}),e.jsxs(u,{className:"text-foreground font-medium",children:["$",r.price_clp.toLocaleString("es-CL")]}),e.jsx(u,{className:"text-center",children:e.jsx(M,{value:r.is_trial_enabled})}),e.jsx(u,{className:"text-center",children:e.jsx(M,{value:r.show_in_agenda})}),e.jsx(u,{className:"text-center",children:e.jsx(ie,{checked:r.is_active,onCheckedChange:w=>s.mutate({id:r.id,isActive:w})})}),e.jsx(u,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>g(r),children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>n(r.id),children:e.jsx(pe,{className:"h-4 w-4 text-destructive"})})]})})]},r.id)})})]})})}),e.jsx(be,{open:b,onClose:Q,service:A}),e.jsx(te,{open:!!t,onOpenChange:()=>n(null),children:e.jsxs(oe,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"¿Eliminar servicio?"}),e.jsx(de,{children:"Esta acción no se puede deshacer. Se eliminará permanentemente el servicio."})]}),e.jsxs(me,{children:[e.jsx(xe,{children:"Cancelar"}),e.jsx(ue,{onClick:()=>t&&a.mutate(t),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})})]})}export{Ke as default};
