import{V as z,r as S,j as e,Y,Z as J,_ as R,$ as Z,I as H,B as A,f as W,s as f,g as y}from"./index-B9mfPZuX.js";import{u as K}from"./useQuery-z7AUZCQX.js";import{u as M}from"./useMutation-Duzi3TGh.js";import{C as $,c as G}from"./card-CGYFfNc-.js";import{T as U,a as X,b as O,c as u,d as ee,e as c}from"./table-CkPv2n-9.js";import{S as D,a as E,b as F,c as k,d as b}from"./select-CVLVF4CZ.js";import{C as se,S as ae}from"./switch-Be1UagDx.js";import{u as re}from"./index.esm-CbFGqNFa.js";import{o as ie,s as v,b as ne,t as le}from"./zod-dLweLgyB.js";import{F as oe,a as h,b as x,c as j,d as p,e as _}from"./form-5rkUVr32.js";import{A as te,b as ce,c as de,d as me,e as ue,f as he,g as xe,h as je}from"./alert-dialog-O4lwZRS9.js";import{P as pe}from"./plus-mq0MpMV4.js";import{P as fe}from"./pencil-B48I2DYU.js";import{T as ge}from"./trash-2-7NlnZDDb.js";import"./index-CFZMp-jq.js";import"./index-C0X3Z_fE.js";import"./chevron-down-Bp5NqgJp.js";import"./chevron-up-SuWsDx17.js";import"./check-Bqw-mN7_.js";import"./label-BPdbOmoR.js";const ve=[{value:"0",label:"Lunes"},{value:"1",label:"Martes"},{value:"2",label:"Miércoles"},{value:"3",label:"Jueves"},{value:"4",label:"Viernes"},{value:"5",label:"Sábado"},{value:"6",label:"Domingo"}],_e=ie({serviceId:v().min(1,"Selecciona un servicio"),professionalId:v().optional(),dayOfWeek:v().min(1,"Selecciona un día"),startTime:v().min(1,"Ingresa la hora"),displayName:v().optional(),badges:v().optional(),isActive:ne().default(!0)});function ye({open:g,onClose:N,entry:n}){const I=z(),t=!!n,{data:d}=K({queryKey:["services-admin-list"],queryFn:async()=>{const{data:s,error:r}=await f.from("services").select("id, name").eq("is_active",!0).order("sort_order");if(r)throw r;return s}}),{data:m}=K({queryKey:["professionals-admin-list"],queryFn:async()=>{const{data:s,error:r}=await f.from("professionals").select("id, name").eq("is_active",!0).order("name");if(r)throw r;return s}}),i=re({resolver:le(_e),defaultValues:{serviceId:"",professionalId:"__none__",dayOfWeek:"",startTime:"",displayName:"",badges:"",isActive:!0}});S.useEffect(()=>{var s;n?i.reset({serviceId:n.service_id,professionalId:n.professional_id||"__none__",dayOfWeek:String(n.day_of_week),startTime:((s=n.start_time)==null?void 0:s.slice(0,5))||"",displayName:n.display_name||"",badges:(n.badges||[]).join(", "),isActive:n.is_active}):i.reset({serviceId:"",professionalId:"__none__",dayOfWeek:"",startTime:"",displayName:"",badges:"",isActive:!0})},[n,i]);const C=M({mutationFn:async s=>{const r=s.badges?s.badges.split(",").map(o=>o.trim()).filter(Boolean):[],T={service_id:s.serviceId,professional_id:s.professionalId==="__none__"?null:s.professionalId||null,day_of_week:parseInt(s.dayOfWeek),start_time:s.startTime,display_name:s.displayName||null,badges:r,is_active:s.isActive};if(t){const{error:o}=await f.from("schedule_entries").update(T).eq("id",n.id);if(o)throw o}else{const{error:o}=await f.from("schedule_entries").insert(T);if(o)throw o}},onSuccess:()=>{I.invalidateQueries({queryKey:["schedule-entries-admin"]}),I.invalidateQueries({queryKey:["schedule-entries"]}),y.success(t?"Horario actualizado":"Horario creado"),N()},onError:s=>y.error(s.message||"Error al guardar")});return e.jsx(Y,{open:g,onOpenChange:N,children:e.jsxs(J,{className:"sm:max-w-md",children:[e.jsx(R,{children:e.jsx(Z,{children:t?"Editar Horario":"Nuevo Horario"})}),e.jsx(oe,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(s=>C.mutate(s)),className:"space-y-4",children:[e.jsx(h,{control:i.control,name:"serviceId",render:({field:s})=>e.jsxs(x,{children:[e.jsx(j,{children:"Servicio"}),e.jsxs(D,{onValueChange:s.onChange,value:s.value,children:[e.jsx(p,{children:e.jsx(E,{children:e.jsx(F,{placeholder:"Selecciona servicio"})})}),e.jsx(k,{children:d==null?void 0:d.map(r=>e.jsx(b,{value:r.id,children:r.name},r.id))})]}),e.jsx(_,{})]})}),e.jsx(h,{control:i.control,name:"professionalId",render:({field:s})=>e.jsxs(x,{children:[e.jsx(j,{children:"Profesional (opcional)"}),e.jsxs(D,{onValueChange:s.onChange,value:s.value,children:[e.jsx(p,{children:e.jsx(E,{children:e.jsx(F,{placeholder:"Sin profesional"})})}),e.jsxs(k,{children:[e.jsx(b,{value:"__none__",children:"Sin profesional"}),m==null?void 0:m.map(r=>e.jsx(b,{value:r.id,children:r.name},r.id))]})]}),e.jsx(_,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(h,{control:i.control,name:"dayOfWeek",render:({field:s})=>e.jsxs(x,{children:[e.jsx(j,{children:"Día"}),e.jsxs(D,{onValueChange:s.onChange,value:s.value,children:[e.jsx(p,{children:e.jsx(E,{children:e.jsx(F,{placeholder:"Día"})})}),e.jsx(k,{children:ve.map(r=>e.jsx(b,{value:r.value,children:r.label},r.value))})]}),e.jsx(_,{})]})}),e.jsx(h,{control:i.control,name:"startTime",render:({field:s})=>e.jsxs(x,{children:[e.jsx(j,{children:"Hora inicio"}),e.jsx(p,{children:e.jsx(H,{...s,type:"time"})}),e.jsx(_,{})]})})]}),e.jsx(h,{control:i.control,name:"displayName",render:({field:s})=>e.jsxs(x,{children:[e.jsx(j,{children:"Nombre display (opcional)"}),e.jsx(p,{children:e.jsx(H,{...s,placeholder:"Override del nombre del servicio"})}),e.jsx(_,{})]})}),e.jsx(h,{control:i.control,name:"badges",render:({field:s})=>e.jsxs(x,{children:[e.jsx(j,{children:"Badges (separados por coma)"}),e.jsx(p,{children:e.jsx(H,{...s,placeholder:"Ice Bath opcional, Sin inmersión"})}),e.jsx(_,{})]})}),e.jsx(h,{control:i.control,name:"isActive",render:({field:s})=>e.jsxs(x,{className:"flex items-center space-x-2",children:[e.jsx(p,{children:e.jsx(se,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx(j,{className:"!mt-0",children:"Activo"})]})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(A,{type:"button",variant:"outline",onClick:N,children:"Cancelar"}),e.jsxs(A,{type:"submit",disabled:C.isPending,children:[C.isPending&&e.jsx(W,{className:"mr-2 h-4 w-4 animate-spin"}),t?"Actualizar":"Crear"]})]})]})})]})})}const B=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"];function Be(){const g=z(),[N,n]=S.useState(!1),[I,t]=S.useState(null),[d,m]=S.useState(null),[i,C]=S.useState("all"),{data:s,isLoading:r}=K({queryKey:["schedule-entries-admin"],queryFn:async()=>{const{data:a,error:l}=await f.from("schedule_entries").select("*, services(name), professionals(name)").order("day_of_week",{ascending:!0}).order("start_time",{ascending:!0});if(l)throw l;return a}}),T=M({mutationFn:async({id:a,isActive:l})=>{const{error:w}=await f.from("schedule_entries").update({is_active:l}).eq("id",a);if(w)throw w},onSuccess:()=>{g.invalidateQueries({queryKey:["schedule-entries-admin"]}),g.invalidateQueries({queryKey:["schedule-entries"]}),y.success("Estado actualizado")},onError:()=>y.error("Error al actualizar")}),o=M({mutationFn:async a=>{const{error:l}=await f.from("schedule_entries").delete().eq("id",a);if(l)throw l},onSuccess:()=>{g.invalidateQueries({queryKey:["schedule-entries-admin"]}),g.invalidateQueries({queryKey:["schedule-entries"]}),y.success("Horario eliminado"),m(null)},onError:()=>y.error("Error al eliminar")}),P=(s==null?void 0:s.filter(a=>i==="all"?!0:a.day_of_week===parseInt(i)))||[];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Horarios Semanales"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(D,{value:i,onValueChange:C,children:[e.jsx(E,{className:"w-[150px]",children:e.jsx(F,{placeholder:"Filtrar día"})}),e.jsxs(k,{children:[e.jsx(b,{value:"all",children:"Todos los días"}),B.map((a,l)=>e.jsx(b,{value:String(l),children:a},l))]})]}),e.jsxs(A,{onClick:()=>{t(null),n(!0)},children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Nuevo Horario"]})]})]}),r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(W,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsx($,{children:e.jsx(G,{className:"p-0",children:e.jsxs(U,{children:[e.jsx(X,{children:e.jsxs(O,{children:[e.jsx(u,{className:"w-24",children:"Día"}),e.jsx(u,{className:"w-20",children:"Hora"}),e.jsx(u,{children:"Servicio"}),e.jsx(u,{children:"Profesional"}),e.jsx(u,{children:"Badges"}),e.jsx(u,{className:"w-16 text-center",children:"Activo"}),e.jsx(u,{className:"text-right w-24",children:"Acciones"})]})}),e.jsx(ee,{children:P.length===0?e.jsx(O,{children:e.jsx(c,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No hay horarios registrados"})}):P.map(a=>{var l,w,V,Q;return e.jsxs(O,{children:[e.jsx(c,{className:"font-medium text-foreground",children:B[a.day_of_week]||"-"}),e.jsx(c,{className:"text-foreground font-mono",children:(l=a.start_time)==null?void 0:l.slice(0,5)}),e.jsxs(c,{children:[e.jsx("div",{className:"font-medium text-foreground",children:a.display_name||((w=a.services)==null?void 0:w.name)||"-"}),a.display_name&&e.jsx("div",{className:"text-xs text-muted-foreground",children:(V=a.services)==null?void 0:V.name})]}),e.jsx(c,{className:"text-muted-foreground",children:((Q=a.professionals)==null?void 0:Q.name)||"-"}),e.jsx(c,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:(a.badges||[]).map((q,L)=>e.jsx("span",{className:"bg-muted text-muted-foreground text-xs px-2 py-0.5 rounded-full",children:q},L))})}),e.jsx(c,{className:"text-center",children:e.jsx(ae,{checked:a.is_active,onCheckedChange:q=>T.mutate({id:a.id,isActive:q})})}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-1",children:[e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>{t(a),n(!0)},children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx(A,{variant:"ghost",size:"sm",onClick:()=>m(a.id),children:e.jsx(ge,{className:"h-4 w-4 text-destructive"})})]})})]},a.id)})})]})})}),e.jsx(ye,{open:N,onClose:()=>{n(!1),t(null)},entry:I}),e.jsx(te,{open:!!d,onOpenChange:()=>m(null),children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:"¿Eliminar horario?"}),e.jsx(ue,{children:"Esta acción eliminará permanentemente este horario del calendario."})]}),e.jsxs(he,{children:[e.jsx(xe,{children:"Cancelar"}),e.jsx(je,{onClick:()=>d&&o.mutate(d),className:"bg-destructive hover:bg-destructive/90",children:"Eliminar"})]})]})})]})}export{Be as default};
