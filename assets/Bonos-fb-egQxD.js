import{d as X,r as o,s as f,g as u,j as e,H as Y,L as $,f as y,I as g,B as N}from"./index-DVQK76kR.js";import{u as Z}from"./index.esm-UGO8nned.js";import{o as ee,s as C,t as se}from"./zod-D2sccAeU.js";import{C as A}from"./card-Hz9pFq0E.js";import{L as b}from"./label-CtCi2-u5.js";import{F as re}from"./Footer-D8_8Qm7q.js";import{P as te}from"./PurchaseFAQ-ChPzvxgu.js";import{u as ae}from"./useFacebookConversionsAPI-Dh-1xV2i.js";import{P as ne}from"./package-ia8gPIdE.js";import{C as oe}from"./circle-check-CY-4n73-.js";import{C as ie}from"./calendar-CmmQLej1.js";import"./accordion-DnXR4OiC.js";import"./index-BsJ-3Nvm.js";const ce=ee({buyerName:C().min(2,"El nombre debe tener al menos 2 caracteres").max(100),buyerEmail:C().email("Email invÃ¡lido").max(255),buyerPhone:C().min(8,"TelÃ©fono invÃ¡lido").max(20)});function Ne(){var I,k;const{trackEvent:S}=X(),{trackServerEvent:w}=ae(),[c,B]=o.useState([]),[P,V]=o.useState([]),[a,D]=o.useState(null),[T,M]=o.useState(!0),[i,E]=o.useState(!1);o.useEffect(()=>{const s=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;S("ViewContent",{content_name:"Bonos de Sesiones",content_category:"Package"},s),w({eventName:"ViewContent",eventId:s,contentName:"Bonos de Sesiones"}).catch(()=>{})},[]);const[x,_]=o.useState(""),[t,p]=o.useState(null),[L,h]=o.useState(""),[j,q]=o.useState(!1),{register:v,handleSubmit:G,formState:{errors:l}}=Z({resolver:se(ce)}),R=s=>{D(s),window.innerWidth<768&&setTimeout(()=>{var r;(r=document.getElementById("purchase-form"))==null||r.scrollIntoView({behavior:"smooth",block:"start"})},100)};o.useEffect(()=>{z(),H()},[]);const z=async()=>{try{const{data:s,error:r}=await f.from("session_packages").select("*").eq("is_active",!0).order("sessions_quantity",{ascending:!0});if(r)throw r;B(s||[])}catch(s){console.error("Error loading packages:",s),u.error("Error al cargar los paquetes")}finally{M(!1)}},H=async()=>{try{const{data:s,error:r}=await f.from("services").select("id, name, price_clp").eq("is_active",!0);if(r)throw r;V(s||[])}catch(s){console.error("Error loading services:",s)}},O=s=>{const r=P.filter(d=>s.applicable_service_ids.includes(d.id));if(r.length===0)return 0;const n=r.reduce((d,K)=>d+K.price_clp,0)/r.length*s.sessions_quantity;return Math.floor(n-s.price_clp)},Q=s=>P.filter(r=>s.includes(r.id)).map(r=>r.name).join(", "),U=async()=>{if(!(!x.trim()||!a)){q(!0),h(""),p(null);try{const s=c.find(n=>n.id===a),{data:r,error:m}=await f.functions.invoke("validate-coupon",{body:{code:x.toUpperCase(),packageId:a,purchaseAmount:s==null?void 0:s.price_clp}});if(m||!(r!=null&&r.valid)){h((r==null?void 0:r.error)||"CupÃ³n no encontrado");return}p(r.coupon),u.success("Â¡CupÃ³n aplicado!")}catch(s){console.error("Error validating coupon:",s),h("Error al validar cupÃ³n")}finally{q(!1)}}},F=s=>{if(!t)return s;let r=0;return t.discount_type==="percentage"?r=Math.floor(s*(t.discount_value/100)):r=t.discount_value,Math.max(0,s-r)},W=s=>t?s-F(s):0,J=async s=>{if(!a){u.error("Selecciona un paquete");return}const r=c.find(n=>n.id===a),m=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;S("InitiateCheckout",{content_name:(r==null?void 0:r.name)||"Paquete de sesiones",currency:"CLP",value:(r==null?void 0:r.price_clp)||0},m),w({eventName:"InitiateCheckout",eventId:m,userEmail:s.buyerEmail,userName:s.buyerName,userPhone:s.buyerPhone,contentName:(r==null?void 0:r.name)||"Paquete de sesiones",value:(r==null?void 0:r.price_clp)||0,currency:"CLP"}).catch(()=>{}),E(!0);try{const{data:n,error:d}=await f.functions.invoke("purchase-session-package",{body:{packageId:a,couponCode:t==null?void 0:t.code,...s}});if(d)throw new Error(d.message||"Error al procesar la compra");if(n.freeOrder){u.success("Â¡Compra completada! Revisa tu email para obtener tus cÃ³digos."),window.location.href="/bonos/success?free=true";return}if(n.initPoint)window.location.href=n.initPoint;else throw new Error("No se pudo generar el link de pago")}catch(n){console.error("Error purchasing package:",n),u.error(n.message||"Error al procesar la compra"),E(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsx("title",{children:"Bonos de Sesiones - Studio La Nave"}),e.jsx("meta",{name:"description",content:"Compra paquetes de sesiones con descuento en Studio La Nave. Ahorra y disfruta de mÃºltiples sesiones de yoga, mÃ©todo Wim Hof y mÃ¡s."})]}),e.jsx("main",{className:"min-h-screen pt-24 pb-16 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Paquetes de Sesiones"}),e.jsxs("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:["Compra un pack de sesiones, recibe tus cÃ³digos por email y reserva cuando quieras en nuestra"," ",e.jsx($,{to:"/agenda-nave-studio",className:"text-primary hover:underline font-medium",children:"agenda"}),". Puedes compartirlos con quien tÃº quieras."]})]}),e.jsxs("div",{className:"mb-12 p-6 md:p-8 bg-[#E9F6F9] rounded-2xl text-center max-w-2xl mx-auto",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸŽâ„ï¸"}),e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-primary mb-3",children:"Â¿Quieres regalar sesiones?"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Sorprende a alguien especial con una Gift Card. RecibirÃ¡ un cÃ³digo para agendar cuando quiera."}),e.jsx($,{to:"/giftcards",className:"inline-flex items-center justify-center gap-2 bg-accent hover:bg-primary text-white font-semibold px-6 py-3 rounded-xl transition-all duration-300 hover:scale-105",children:"ðŸ§Š Comprar Gift Card"})]}),T?e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx(y,{className:"h-8 w-8 animate-spin"})}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Paquetes Disponibles"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"Las sesiones las puedes compartir con quien tÃº quieras"}),c.map(s=>{const r=O(s);return e.jsx(A,{className:`p-6 cursor-pointer transition-all ${a===s.id?"border-primary shadow-lg":"hover:shadow-md"}`,onClick:()=>R(s.id),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ne,{className:"h-5 w-5 text-primary"}),e.jsx("h3",{className:"text-xl font-bold",children:s.name})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s.description}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4 text-green-600"}),e.jsxs("span",{children:[s.sessions_quantity," sesiones"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["VÃ¡lido por ",s.validity_days," dÃ­as"]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["VÃ¡lido para: ",Q(s.applicable_service_ids)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold text-primary",children:["$",s.price_clp.toLocaleString("es-CL")]}),r>0&&e.jsxs("p",{className:"text-xs text-green-600 font-semibold mt-1",children:["Ahorras $",r.toLocaleString("es-CL")]})]})]})},s.id)})]}),e.jsx("div",{id:"purchase-form",children:e.jsxs(A,{className:"p-6 sticky top-24",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Completa tus datos"}),!a&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Selecciona un paquete para continuar"}),a&&e.jsxs("form",{onSubmit:G(J),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"buyerName",children:"Nombre completo *"}),e.jsx(g,{id:"buyerName",...v("buyerName"),placeholder:"Juan PÃ©rez",disabled:i}),l.buyerName&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:l.buyerName.message})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"buyerEmail",children:"Email *"}),e.jsx(g,{id:"buyerEmail",type:"email",...v("buyerEmail"),placeholder:"juan@ejemplo.com",disabled:i}),l.buyerEmail&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:l.buyerEmail.message})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"buyerPhone",children:"Celular *"}),e.jsx(g,{id:"buyerPhone",...v("buyerPhone"),placeholder:"+56912345678",disabled:i}),l.buyerPhone&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:l.buyerPhone.message})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(b,{htmlFor:"couponCode",children:"Â¿Tienes un cÃ³digo de descuento?"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(g,{id:"couponCode",value:x,onChange:s=>{_(s.target.value.toUpperCase()),h(""),p(null)},placeholder:"CODIGO",className:"font-mono uppercase",disabled:i||j||!!t}),!t&&e.jsx(N,{type:"button",variant:"outline",onClick:U,disabled:!x.trim()||j||i,children:j?e.jsx(y,{className:"h-4 w-4 animate-spin"}):"Aplicar"}),t&&e.jsx(N,{type:"button",variant:"ghost",onClick:()=>{p(null),_("")},disabled:i,children:"Quitar"})]}),L&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:L}),t&&a&&e.jsxs("div",{className:"mt-3 p-3 bg-green-50 dark:bg-green-950/20 rounded-lg border border-green-200 dark:border-green-900",children:[e.jsxs("p",{className:"text-sm font-semibold text-green-700 dark:text-green-400",children:["âœ“ CupÃ³n ",t.code," aplicado"]}),e.jsx("p",{className:"text-xs text-green-600 dark:text-green-500 mt-1",children:t.discount_type==="percentage"?`-${t.discount_value}%`:`-$${t.discount_value.toLocaleString("es-CL")}`})]})]}),a&&t&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground line-through",children:"Precio original:"}),e.jsxs("span",{className:"text-muted-foreground line-through",children:["$",(I=c.find(s=>s.id===a))==null?void 0:I.price_clp.toLocaleString("es-CL")]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-green-600 dark:text-green-400",children:[e.jsx("span",{children:"Descuento:"}),e.jsxs("span",{children:["-$",W(c.find(s=>s.id===a).price_clp).toLocaleString("es-CL")]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[e.jsx("span",{children:"Total a pagar:"}),e.jsxs("span",{className:"text-primary",children:["$",F(c.find(s=>s.id===a).price_clp).toLocaleString("es-CL")]})]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"ðŸ“§ RecibirÃ¡s tus cÃ³digos por email"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Cada cÃ³digo puede usarse una vez. Guarda el email para tener tus cÃ³digos siempre disponibles."})]}),e.jsxs("div",{className:"bg-primary/10 rounded-lg p-3 border border-primary/20",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Seleccionaste:"}),e.jsx("p",{className:"font-semibold text-primary",children:(k=c.find(s=>s.id===a))==null?void 0:k.name})]}),e.jsx(N,{type:"submit",disabled:i,className:"w-full",size:"lg",children:i?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"Procesando..."]}):"Comprar y pagar"})]})]})})]})]})}),e.jsx(te,{type:"bonos"}),e.jsx(re,{})]})}export{Ne as default};
